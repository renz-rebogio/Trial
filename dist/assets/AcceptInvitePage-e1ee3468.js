import{b2 as f,G as v,E as w,w as y,u as a,x as C,j as e,a as N,q as p}from"./index-12920841.js";import{C as k,a as b,b as A,d as P,c as E}from"./card-35f92528.js";import I from"./AuthPage-3122eb57.js";import{A as S}from"./alert-triangle-645f63bd.js";import{C as T}from"./check-circle-279955fc.js";import"./tabs-4a2744f5.js";import"./types-70567253.js";import"./eye-off-098e12ae.js";import"./eye-3f9d66f7.js";import"./cpu-8c7c0810.js";const W=()=>{const[o]=f(),c=v(),{user:l,loading:u}=w(),{toast:m}=y(),[x,s]=a.useState("loading"),[n,r]=a.useState("Verifying your invitation..."),[i,h]=a.useState(null);a.useEffect(()=>{const t=o.get("token");if(!t){s("error"),r("No invitation token found. Please use the link from your email.");return}h(t)},[o]),a.useEffect(()=>{u||!i||(l?(s("processing"),r("Processing your invitation..."),g()):(s("authenticating"),r("Please log in or create an account to accept your invitation.")))},[l,u,i]);const g=async()=>{try{const{data:t,error:d}=await C.functions.invoke("verify-and-accept-invite",{body:{token:i}});if(d)throw new Error(d.message);if(t.error)throw new Error(t.error);s("success"),r("Successfully joined the project! Redirecting you now..."),m({title:"Invitation Accepted!",description:"You have been added to the project."}),setTimeout(()=>{c(`/project/${t.projectId}/editor`)},2e3)}catch(t){s("error"),r(t.message||"An unknown error occurred."),m({variant:"destructive",title:"Failed to Accept Invitation",description:t.message})}},j=()=>{switch(x){case"loading":return e.jsx(p,{className:"h-8 w-8 animate-spin text-primary"});case"processing":return e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"h-8 w-8 animate-spin text-primary mb-4"}),e.jsx("p",{children:n})]});case"success":return e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-8 w-8 text-green-500 mb-4"}),e.jsx("p",{children:n})]});case"error":return e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-8 w-8 text-destructive mb-4"}),e.jsx("p",{children:n}),e.jsx(N,{onClick:()=>c("/"),className:"mt-4",children:"Go to Homepage"})]});case"authenticating":return e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("p",{className:"text-center mb-4",children:n}),e.jsx(I,{isModal:!0})]});default:return null}};return e.jsx("div",{className:"container mx-auto py-12 flex justify-center",children:e.jsxs(k,{className:"w-full max-w-lg shadow-xl",children:[e.jsxs(b,{children:[e.jsx(A,{children:"Accept Project Invitation"}),e.jsx(P,{children:"Welcome to Boogasi Deal Maker"})]}),e.jsx(E,{className:"flex flex-col items-center justify-center min-h-[200px]",children:j()})]})})};export{W as default};
