import{c as v,j as e,aj as U,m as c,L as y,A as Z,h as J,i as K,a as g,q as j,ak as Q,ah as X,D as ee,l as te,n as se,o as ae,s as re,t as ie,u as l,x as w,ag as le,E as ne,w as oe,G as ce}from"./index-59f5f71c.js";import{S as M}from"./star-b18d8e2a.js";import{S as de}from"./shield-check-edb87d7b.js";import{I as me}from"./info-017772ed.js";import{T as ue,a as xe,b as z,c as F}from"./tabs-ff4fd230.js";import{T as he}from"./textarea-e62d43bd.js";import{C as $,a as pe,c as ge,b as fe,e as ye}from"./card-b8828134.js";import{A as q}from"./alert-triangle-809582fd.js";import{P as ve}from"./package-075c04ac.js";import{A as je}from"./arrow-left-93b2452d.js";import{M as be}from"./message-square-1223fc40.js";const Ne=v("DownloadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m8 17 4 4 4-4",key:"1ul180"}]]),_e=v("FileImage",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["circle",{cx:"10",cy:"13",r:"2",key:"6v46hv"}],["path",{d:"m20 17-1.09-1.09a2 2 0 0 0-2.82 0L10 22",key:"17vly1"}]]),we=v("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]),ke=v("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),Pe=({images:t,product:a,activeImageIndex:r,setActiveImageIndex:m})=>{var i,h,d;return e.jsxs("div",{className:"space-y-4",children:[e.jsx(U,{mode:"wait",children:e.jsx(c.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},className:"aspect-video bg-muted rounded-lg overflow-hidden shadow-lg border border-border",children:t.length>0&&((i=t[r])!=null&&i.image_url)?e.jsx("img",{src:(h=t[r])==null?void 0:h.image_url,alt:((d=t[r])==null?void 0:d.alt_text)||a.title,className:"w-full h-full object-contain"}):a.video_url?e.jsx("video",{src:a.video_url,controls:!0,className:"w-full h-full object-contain"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:e.jsx(_e,{size:64,className:"text-muted-foreground/50"})})},r)}),t.length>1&&e.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2",children:t.map((n,o)=>e.jsx("button",{onClick:()=>m(o),className:`w-20 h-20 rounded-md overflow-hidden border-2 transition-all ${r===o?"border-primary shadow-md":"border-transparent hover:border-muted-foreground/50"}`,children:e.jsx("img",{src:n.image_url,alt:`Thumbnail ${o+1}`,className:"w-full h-full object-cover"})},n.id||`img-${o}`))})]})},Se=({product:t,seller:a,averageRating:r,reviewsCount:m,isPurchasing:i,onPurchase:h,user:d})=>{var o;const n=a==null?void 0:a.profiles;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(c.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-4xl font-bold tracking-tight text-foreground leading-tight",children:t.title}),n&&e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:e.jsxs(y,{to:`/store/${a.id}`,className:"flex items-center group",children:[e.jsxs(Z,{className:"h-8 w-8 mr-2 border",children:[e.jsx(J,{src:n.avatar_url,alt:n.screen_name}),e.jsx(K,{children:((o=n.screen_name)==null?void 0:o.substring(0,1).toUpperCase())||"S"})]}),e.jsxs("span",{className:"text-sm text-muted-foreground group-hover:text-primary transition-colors",children:["Sold by: ",n.screen_name||a.company_name]})]})}),e.jsxs(c.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex items-center",children:[...Array(5)].map((p,s)=>e.jsx(M,{size:20,className:s<Math.round(r)?"text-yellow-400 fill-yellow-400":"text-muted-foreground/30"},s))}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",m," reviews)"]}),t.digital_product_categories&&e.jsx("span",{className:"px-2 py-0.5 bg-secondary text-secondary-foreground text-xs rounded-full",children:t.digital_product_categories.name})]}),e.jsxs(c.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-3xl font-semibold text-primary",children:["$",parseFloat(t.price).toFixed(2)]}),e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:e.jsxs(g,{size:"lg",className:"w-full bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 text-primary-foreground shadow-lg transform hover:scale-105 transition-transform",onClick:h,disabled:i||!d,children:[i?e.jsx(j,{className:"mr-2 h-5 w-5 animate-spin"}):e.jsx(Q,{className:"mr-2 h-5 w-5"}),i?"Processing...":d?"Buy Now / Get Access":"Login to Purchase"]})}),t.short_description&&e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"text-muted-foreground text-sm",children:e.jsx("p",{children:t.short_description})}),t.product_file_url&&e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.65},children:e.jsxs("a",{href:t.product_file_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-sm text-primary hover:underline",children:[e.jsx(Ne,{size:16,className:"mr-1.5"})," Downloadable File Included"]})}),t.video_url&&(!t.images||t.images.length===0)&&e.jsx(c.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.65},children:e.jsxs("a",{href:t.video_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-sm text-primary hover:underline",children:[e.jsx(we,{size:16,className:"mr-1.5"})," Preview Video Available"]})}),e.jsxs(c.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.7},className:"space-y-3 pt-4 border-t border-border",children:[t.guarantee_warranty&&e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(de,{size:18,className:"mr-2 mt-0.5 text-green-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-foreground",children:"Guarantee/Warranty:"})," ",e.jsx("span",{className:"text-muted-foreground",children:t.guarantee_warranty})]})]}),t.delivery_instructions&&e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(me,{size:18,className:"mr-2 mt-0.5 text-blue-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-foreground",children:"Delivery:"})," ",e.jsx("span",{className:"text-muted-foreground",children:t.delivery_instructions})]})]}),t.tags&&t.tags.length>0&&e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(ke,{size:18,className:"mr-2 mt-0.5 text-purple-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-foreground",children:"Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.tags.map(p=>e.jsx("span",{className:"px-1.5 py-0.5 bg-muted text-muted-foreground text-xs rounded",children:p},p))})]})]}),(a==null?void 0:a.website_portfolio)&&e.jsxs("div",{className:"flex items-start text-sm",children:[e.jsx(X,{size:18,className:"mr-2 mt-0.5 text-sky-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("strong",{className:"text-foreground",children:"Seller's Site:"})," ",e.jsx("a",{href:a.website_portfolio,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:a.website_portfolio})]})]})]})]})},Ce=({product:t})=>e.jsx(c.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"mt-12 lg:mt-16",children:e.jsxs(ue,{defaultValue:"description",className:"w-full",children:[e.jsxs(xe,{className:"grid w-full grid-cols-2 md:w-auto md:inline-flex mb-6",children:[e.jsx(z,{value:"description",children:"Full Description"}),e.jsx(z,{value:"delivery",children:"Delivery & Access"})]}),e.jsx(F,{value:"description",className:"prose prose-sm max-w-none p-4 border rounded-md bg-card text-card-foreground",children:t.full_description?e.jsx("div",{dangerouslySetInnerHTML:{__html:t.full_description.replace(/\n/g,"<br />")}}):e.jsx("p",{children:"No detailed description provided."})}),e.jsxs(F,{value:"delivery",className:"p-4 border rounded-md bg-card text-card-foreground",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"How You'll Get Your Product:"}),t.access_link_after_purchase&&e.jsxs("p",{className:"mb-2",children:["An access link will be provided: ",e.jsx("a",{href:t.access_link_after_purchase,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:t.access_link_after_purchase})]}),t.product_file_url&&e.jsxs("p",{className:"mb-2",children:["A download link for the product file will be available: ",e.jsx("a",{href:t.product_file_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Download File"})]}),t.delivery_instructions&&e.jsx("p",{className:"text-muted-foreground whitespace-pre-line",children:t.delivery_instructions}),!t.access_link_after_purchase&&!t.product_file_url&&!t.delivery_instructions&&e.jsx("p",{className:"text-muted-foreground",children:"Delivery details will be provided by the seller upon purchase."})]})]})}),Re=({isOpen:t,onOpenChange:a,productTitle:r,reviewRating:m,setReviewRating:i,reviewText:h,setReviewText:d,onSubmit:n,isSubmitting:o})=>e.jsx(ee,{open:t,onOpenChange:a,children:e.jsxs(te,{className:"sm:max-w-lg glassmorphic",children:[e.jsxs(se,{children:[e.jsxs(ae,{children:["Write a Review for ",r]}),e.jsx(re,{children:"Share your thoughts about this product with the community."})]}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Rating"}),e.jsx("div",{className:"flex mt-1",children:[...Array(5)].map((p,s)=>e.jsx(M,{size:24,className:`cursor-pointer ${s<m?"text-yellow-400 fill-yellow-400":"text-muted-foreground/30 hover:text-yellow-300"}`,onClick:()=>i(s+1)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reviewText",className:"text-sm font-medium text-foreground",children:"Your Review"}),e.jsx(he,{id:"reviewText",value:h,onChange:p=>d(p.target.value),placeholder:"What did you like or dislike?",rows:4,className:"mt-1 bg-input text-foreground placeholder:text-muted-foreground"})]})]}),e.jsxs(ie,{children:[e.jsx(g,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsxs(g,{onClick:n,disabled:o,children:[o&&e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Review"]})]})]})}),Te=({currentProductId:t,categoryId:a,sellerId:r})=>{const[m,i]=l.useState([]),[h,d]=l.useState(!0),[n,o]=l.useState(null);if(l.useEffect(()=>{(async()=>{if(!a&&!r){d(!1);return}d(!0),o(null);try{let u=w.from("digital_products").select("id, title, price, short_description, sellers(company_name), digital_product_images(image_url, alt_text)").eq("status","active").neq("id",t).limit(4);a?u=u.eq("category_id",a):r&&(u=u.eq("seller_id",r));const{data:b,error:f}=await u;if(f)throw f;i(b||[])}catch(u){console.error("Error fetching related products:",u),o("Could not load related products.")}finally{d(!1)}})()},[t,a,r]),h)return e.jsxs("div",{className:"mt-12 lg:mt-16 py-8 flex justify-center items-center",children:[e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2 text-muted-foreground",children:"Loading related products..."})]});if(n)return e.jsxs("div",{className:"mt-12 lg:mt-16 py-8 text-center",children:[e.jsx(q,{className:"h-8 w-8 mx-auto text-destructive mb-2"}),e.jsx("p",{className:"text-destructive",children:n})]});if(m.length===0)return null;const p={hidden:{opacity:0,y:20},visible:s=>({opacity:1,y:0,transition:{delay:s*.1,duration:.4,ease:"easeOut"}})};return e.jsxs(c.div,{initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.1}}},className:"mt-12 lg:mt-16",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-foreground mb-6 md:mb-8",children:"You Might Also Like"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:m.map((s,u)=>e.jsx(c.custom,{variants:p,custom:u,className:"flex",component:$,children:e.jsxs($,{className:"w-full flex flex-col bg-card hover:shadow-xl transition-shadow duration-300 border-border",children:[e.jsx(pe,{className:"p-0",children:e.jsx(y,{to:`/product/${s.id}`,className:"block aspect-video overflow-hidden rounded-t-lg",children:s.digital_product_images&&s.digital_product_images.length>0&&s.digital_product_images[0].image_url?e.jsx("img",{src:s.digital_product_images[0].image_url,alt:s.digital_product_images[0].alt_text||s.title,className:"w-full h-full object-cover transition-transform duration-300 hover:scale-105"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(ve,{size:48,className:"text-muted-foreground/50"})})})}),e.jsxs(ge,{className:"p-4 flex-grow",children:[e.jsx(fe,{className:"text-lg font-semibold leading-tight mb-1",children:e.jsx(y,{to:`/product/${s.id}`,className:"hover:text-primary transition-colors",children:s.title.length>50?`${s.title.substring(0,47)}...`:s.title})}),s.sellers&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["by ",s.sellers.company_name]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.short_description||"No description available."})]}),e.jsxs(ye,{className:"p-4 border-t border-border/50 flex justify-between items-center",children:[e.jsxs("p",{className:"text-xl font-bold text-primary",children:["$",parseFloat(s.price).toFixed(2)]}),e.jsx(g,{asChild:!0,size:"sm",variant:"outline",className:"hover:bg-primary hover:text-primary-foreground transition-colors",children:e.jsx(y,{to:`/product/${s.id}`,children:"View"})})]})]})},s.id))})]})},Ye=()=>{const{productId:t}=le(),{user:a}=ne(),{toast:r}=oe(),m=ce(),[i,h]=l.useState(null),[d,n]=l.useState(null),[o,p]=l.useState([]),[s,u]=l.useState(0),[b,f]=l.useState(!0),[I,k]=l.useState(!1),[H,N]=l.useState(!1),[G,P]=l.useState(5),[S,C]=l.useState(""),[V,R]=l.useState(!1),[_,Ae]=l.useState([]),[Y,De]=l.useState(0),[T,A]=l.useState(null),D=l.useCallback(async()=>{f(!0),A(null);try{const{data:x,error:L}=await w.from("digital_products").select(`
              *,
              sellers (id, company_name, user_id, website_portfolio, profiles(screen_name, avatar_url)),
              digital_product_categories (id, name)
            `).eq("id",t).eq("status","active").single();if(L||!x)throw L||new Error("Product not found or not active.");h(x),n(x.sellers);const{data:W,error:E}=await w.from("digital_product_images").select("id, image_url, alt_text").eq("product_id",t).order("display_order",{ascending:!0});E&&console.warn("Error fetching product images:",E.message),p(W||[])}catch(x){console.error("Error fetching product data:",x),A(x.message||"Failed to load product details."),r({variant:"destructive",title:"Error",description:x.message})}finally{f(!1)}},[t,r]);l.useEffect(()=>{D()},[D]);const B=async()=>{if(!a){r({variant:"warning",title:"Login Required",description:"Please log in to purchase this product."}),m("/auth");return}k(!0),r({title:"Processing Purchase...",description:"This is a simulated purchase."}),await new Promise(x=>setTimeout(x,1500)),r({title:"Simulated Purchase Complete!",description:`You can now (conceptually) access ${i.title}.`}),i.access_link_after_purchase?r({title:"Access Link",description:`Access at: ${i.access_link_after_purchase}`}):i.product_file_url&&r({title:"Download Link",description:`Download from: ${i.product_file_url}`}),k(!1)},O=async()=>{if(!a){r({variant:"warning",title:"Login Required",description:"Please log in to submit a review."});return}if(!S.trim()){r({variant:"warning",title:"Empty Review",description:"Please write your review."});return}R(!0),await new Promise(x=>setTimeout(x,1e3)),r({title:"Review Submitted!",description:"Thank you for your feedback (simulated)."}),N(!1),C(""),P(5),R(!1)};return b?e.jsx("div",{className:"flex justify-center items-center h-[calc(100vh-200px)]",children:e.jsx(j,{className:"h-16 w-16 animate-spin text-primary"})}):T?e.jsxs("div",{className:"container mx-auto py-10 px-4 text-center",children:[e.jsx(q,{className:"h-12 w-12 mx-auto text-destructive mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-destructive mb-2",children:"Could not load product"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:T}),e.jsx(g,{onClick:()=>m("/"),children:"Go to Homepage"})]}):i?e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs(g,{variant:"outline",onClick:()=>m(-1),className:"mb-6 text-muted-foreground hover:text-primary",children:[e.jsx(je,{size:18,className:"mr-2"})," Back"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8 lg:gap-12",children:[e.jsx(Pe,{images:o,product:i,activeImageIndex:s,setActiveImageIndex:u}),e.jsx(Se,{product:i,seller:d,averageRating:Y,reviewsCount:_.length,isPurchasing:I,onPurchase:B,user:a})]}),e.jsx(Ce,{product:i}),e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9},className:"mt-12 pt-8 border-t border-border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-foreground",children:["Customer Reviews (",_.length,")"]}),a&&e.jsxs(g,{variant:"outline",onClick:()=>N(!0),children:[e.jsx(be,{size:16,className:"mr-2"})," Write a Review"]})]}),_.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No reviews yet. Be the first to review this product!"}):e.jsx("div",{className:"space-y-6"})]}),e.jsx(Re,{isOpen:H,onOpenChange:N,productTitle:i.title,reviewRating:G,setReviewRating:P,reviewText:S,setReviewText:C,onSubmit:O,isSubmitting:V}),e.jsx(Te,{currentProductId:i.id,categoryId:i.category_id,sellerId:i.seller_id})]}):e.jsx("div",{className:"text-center py-10",children:"Product not found. It might have been removed or is no longer active."})};export{Ye as default};
