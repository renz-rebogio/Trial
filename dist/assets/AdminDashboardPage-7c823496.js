import{u as n,w as v,x as m,j as e,q as u,a as x,r as _,F as b,ai as N,aW as w}from"./index-12920841.js";import{C as y,a as C,b as D,d as k,c as E}from"./card-35f92528.js";import{R as S}from"./refresh-cw-3a7dbd64.js";import{C as R}from"./check-circle-279955fc.js";import{X as A}from"./x-circle-58df0267.js";import{f as B}from"./formatDistanceToNow-68c36ecf.js";import"./getRoundingMethod-e037ee83.js";import"./endOfMonth-533ac367.js";const L=()=>{const[p,j]=n.useState([]),[c,f]=n.useState(!0),[o,h]=n.useState(null),{toast:d}=v(),l=n.useCallback(async()=>{f(!0);try{const{data:s,error:a}=await m.from("verification_documents").select(`
              *,
              profiles:user_id (
                name,
                email,
                screen_name,
                investment_profiles:investment_profiles!user_id(investment_range_max, applicant_type)
              )
            `).eq("verification_status","pending_review").order("upload_date",{ascending:!0});if(a)throw a;const i=s.reduce((r,t)=>(r[t.user_id]||(r[t.user_id]={user_id:t.user_id,profile:t.profiles,documents:[],submitted_at:t.upload_date}),r[t.user_id].documents.push(t),new Date(t.upload_date)<new Date(r[t.user_id].submitted_at)&&(r[t.user_id].submitted_at=t.upload_date),r),{});j(Object.values(i))}catch(s){d({variant:"destructive",title:"Error fetching requests",description:s.message})}finally{f(!1)}},[d]);n.useEffect(()=>{l()},[l]);const g=async(s,a)=>{h(s);try{const{error:i}=await m.from("investment_profiles").update({verification_status:a,is_verified:a==="approved",verification_date:new Date().toISOString()}).eq("user_id",s);if(i)throw new Error(`Profile update failed: ${i.message}`);const{error:r}=await m.from("verification_documents").update({verification_status:a,verified_at:new Date().toISOString()}).eq("user_id",s).eq("verification_status","pending_review");if(r)throw new Error(`Documents update failed: ${r.message}`);d({title:"Success",description:`User verification has been ${a}.`}),l()}catch(i){d({variant:"destructive",title:"Action Failed",description:i.message})}finally{h(null)}};return c?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(u,{className:"h-8 w-8 animate-spin"})," ",e.jsx("span",{className:"ml-2",children:"Loading verification requests..."})]}):e.jsxs(y,{className:"shadow-lg bg-card/80 backdrop-blur-sm",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(D,{children:"Investor Verification Queue"}),e.jsx(k,{children:"Review and process pending investor verification requests."})]}),e.jsx(x,{variant:"ghost",size:"icon",onClick:l,disabled:c,children:e.jsx(S,{className:`h-4 w-4 ${c?"animate-spin":""}`})})]}),e.jsx(E,{children:p.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No pending verification requests. Great job!"}):e.jsx("div",{className:"space-y-4",children:p.map(s=>{var a,i,r;return e.jsxs("div",{className:"border p-4 rounded-lg bg-background/50",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-primary"}),((a=s.profile)==null?void 0:a.name)||((i=s.profile)==null?void 0:i.screen_name)||"Unnamed User"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(r=s.profile)==null?void 0:r.email}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Submitted: ",B(new Date(s.submitted_at),{addSuffix:!0})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 sm:mt-0",children:[e.jsxs(x,{size:"sm",variant:"outline",className:"border-green-500 text-green-500 hover:bg-green-500/10 hover:text-green-400",onClick:()=>g(s.user_id,"approved"),disabled:o===s.user_id,children:[o===s.user_id?e.jsx(u,{className:"h-4 w-4 animate-spin"}):e.jsx(R,{className:"h-4 w-4 mr-2"}),"Approve"]}),e.jsxs(x,{size:"sm",variant:"outline",className:"border-red-500 text-red-500 hover:bg-red-500/10 hover:text-red-400",onClick:()=>g(s.user_id,"rejected"),disabled:o===s.user_id,children:[o===s.user_id?e.jsx(u,{className:"h-4 w-4 animate-spin"}):e.jsx(A,{className:"h-4 w-4 mr-2"}),"Deny"]})]})]}),e.jsxs("div",{className:"mt-4 border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Submitted Documents:"}),e.jsx("ul",{className:"space-y-2",children:s.documents.map(t=>e.jsxs("li",{className:"flex items-center justify-between text-sm p-2 bg-muted/30 rounded-md",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),t.document_type]}),e.jsxs("a",{href:t.document_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline flex items-center gap-1",children:["View Document ",e.jsx(N,{className:"h-3 w-3"})]})]},t.id))})]})]},s.user_id)})})})]})},M=()=>e.jsxs(e.Fragment,{children:[e.jsxs(w,{children:[e.jsx("title",{children:"Admin Dashboard | Boogasi"}),e.jsx("meta",{name:"description",content:"Manage user verifications and other administrative tasks on the Boogasi platform."}),e.jsx("meta",{property:"og:title",content:"Admin Dashboard | Boogasi"}),e.jsx("meta",{property:"og:description",content:"Manage user verifications and other administrative tasks on the Boogasi platform."})]}),e.jsx("div",{className:"min-h-screen bg-background text-foreground brighter-theme-area",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-extrabold tracking-tight lg:text-5xl bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary",children:"Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Central hub for managing platform operations."})]}),e.jsx("main",{children:e.jsx(L,{})})]})})]});export{M as default};
