import{E as de,w as ue,u as h,j as e,p as o,I as m,a as w,q as me,x as y}from"./index-59f5f71c.js";import{o as pe,s as d,p as ge,n as he,l as A,a as xe,b as ve,u as fe,C as X,t as je}from"./types-9a93e89b.js";import{T as E}from"./textarea-e62d43bd.js";import{S as z,a as Y,b as Z,c as q,d as J}from"./select-4f727b9b.js";import{C as ye}from"./checkbox-5ec660f3.js";import{U as be}from"./upload-cloud-99f1496b.js";import{X as k}from"./x-circle-3542237b.js";import{V as Ne}from"./video-e62a3e1e.js";import{P as Ie}from"./plus-circle-3fa46472.js";const Ue=pe({title:d().min(5,"Title must be at least 5 characters").max(150),shortDescription:d().min(10,"Short description is too short").max(500),fullDescription:d().min(20,"Full description is too short"),price:ge(a=>parseFloat(String(a)),he({invalid_type_error:"Price must be a number."}).positive({message:"Price must be positive."})),discountCode:d().optional(),guaranteeWarranty:d().min(1,"Please select a guarantee/warranty option"),accessLinkAfterPurchase:d().url("Must be a valid URL for access/registration").optional().or(A("")),categoryId:d().min(1,"Please select a category"),tags:xe(d().min(1)).min(1,"Add at least one tag").max(10,"Maximum 10 tags"),productFileUrl:d().url("Must be a valid URL for file download").optional().or(A("")),videoUrl:d().url("Must be a valid URL for video").optional().or(A("")),deliveryInstructions:d().optional(),agreeToCommission:ve().refine(a=>a===!0,{message:"You must agree to the 25% commission terms."})}).refine(a=>a.productFileUrl||a.accessLinkAfterPurchase||a.deliveryInstructions,{message:"Please provide either a product file URL, an access link, or delivery instructions.",path:["productFileUrl"]}),b=5,P=2,_e=P*1024*1024,F=50,we=F*1024*1024,K="boogasi",Me=({sellerData:a,onProductSubmitted:M})=>{const{user:C}=de(),{toast:n}=ue(),[V,D]=h.useState(!1),[H,Q]=h.useState([]),[$,S]=h.useState([]),[N,T]=h.useState([]),[B,x]=h.useState(null),[I,v]=h.useState(""),[U,R]=h.useState(""),{register:u,handleSubmit:ee,control:O,formState:{errors:r},setValue:L,watch:p,reset:te}=fe({resolver:je(Ue),defaultValues:{title:"",shortDescription:"",fullDescription:"",price:"",discountCode:"",guaranteeWarranty:"",accessLinkAfterPurchase:"",categoryId:"",tags:[],productFileUrl:"",videoUrl:"",deliveryInstructions:"",agreeToCommission:!1}});h.useEffect(()=>{(async()=>{const{data:s,error:c}=await y.from("digital_product_categories").select("id, name").order("name");c?n({variant:"destructive",title:"Error fetching categories",description:c.message}):Q(s||[])})()},[n]);const se=t=>{const s=Array.from(t.target.files),c=[],l=[];s.forEach(i=>{if($.length+c.length>=b){n({variant:"destructive",title:"Image Limit",description:`Max ${b} images.`});return}if(i.size>_e){n({variant:"destructive",title:"File Too Large",description:`Image "${i.name}" exceeds ${P}MB.`});return}if(!i.type.startsWith("image/")){n({variant:"destructive",title:"Invalid File Type",description:`"${i.name}" is not an image.`});return}c.push(i),l.push(URL.createObjectURL(i))}),S(i=>[...i,...c].slice(0,b)),T(i=>[...i,...l].slice(0,b)),t.target.value=null},re=t=>{URL.revokeObjectURL(N[t]),S(s=>s.filter((c,l)=>l!==t)),T(s=>s.filter((c,l)=>l!==t))},ie=t=>{const s=t.target.files[0];if(s){if(s.size>we){n({variant:"destructive",title:"Video Too Large",description:`Video exceeds ${F}MB.`}),x(null),v(""),t.target.value=null;return}if(!s.type.startsWith("video/")){n({variant:"destructive",title:"Invalid File Type",description:"Please upload a valid video file."}),x(null),v(""),t.target.value=null;return}x(s),v(s.name)}else x(null),v("")},G=()=>{x(null),v("");const t=document.getElementById("productVideo");t&&(t.value=null)},ae=()=>{U.trim()&&!p("tags").includes(U.trim())&&p("tags").length<10?(L("tags",[...p("tags"),U.trim()]),R("")):p("tags").length>=10&&n({variant:"destructive",title:"Tag Limit",description:"Maximum 10 tags allowed."})},oe=t=>{L("tags",p("tags").filter(s=>s!==t))},W=async(t,s,c)=>{if(!t||!C||!(a!=null&&a.id))return console.error("User, sellerData, or file missing for upload."),null;const l=`${s}/${c}-${Date.now()}-${t.name.replace(/\s+/g,"_")}`;try{const{data:i,error:f}=await y.storage.from(K).upload(l,t,{cacheControl:"3600",upsert:!1,contentType:t.type});if(f)throw f;const{data:j}=y.storage.from(K).getPublicUrl(i.path);return j.publicUrl}catch(i){throw console.error(`Error uploading ${c}:`,i),n({variant:"destructive",title:`${c} Upload Failed`,description:i.message}),i}},ce=async t=>{if(!C||!(a!=null&&a.id)){n({variant:"destructive",title:"Error",description:"User or seller data is missing. Please try again."});return}D(!0);try{const s=`temp-${Date.now()}`,c=`digital-products/${a.id}/${s}`;let l=t.videoUrl||null;if(B&&(l=await W(B,c,"video"),!l))throw new Error("Video upload failed and is required if file provided.");const{data:i,error:f}=await y.from("digital_products").insert({seller_id:a.id,user_id:C.id,title:t.title,short_description:t.shortDescription,full_description:t.fullDescription,price:t.price,discount_code:t.discountCode||null,guarantee_warranty:t.guaranteeWarranty,access_link_after_purchase:t.accessLinkAfterPurchase||null,category_id:t.categoryId,tags:t.tags,status:"pending_approval",product_file_url:t.productFileUrl||null,video_url:l,delivery_instructions:t.deliveryInstructions||null}).select().single();if(f)throw f;const j=[],le=`digital-products/${a.id}/${i.id}`;for(const g of $)try{const _=await W(g,le,"image");_&&j.push({product_id:i.id,image_url:_,alt_text:g.name})}catch(_){console.warn(`Failed to upload image ${g.name}: ${_.message}`)}if(j.length>0){const{error:g}=await y.from("digital_product_images").insert(j);g&&console.warn("Error inserting image records to DB:",g.message)}n({title:"Product Submitted!",description:`${t.title} is pending approval.`}),te(),N.forEach(g=>URL.revokeObjectURL(g)),T([]),S([]),G(),M&&M(i)}catch(s){n({variant:"destructive",title:"Product Submission Failed",description:s.message})}finally{D(!1)}},ne=[{value:"7-day refund",label:"7-Day Money Back Guarantee"},{value:"14-day refund",label:"14-Day Money Back Guarantee"},{value:"30-day refund",label:"30-Day Money Back Guarantee"},{value:"lifetime access",label:"Lifetime Access (No Refunds)"},{value:"no refund",label:"No Refunds"},{value:"custom",label:"Custom Policy (detail in description)"}];return e.jsxs("form",{onSubmit:ee(ce),className:"space-y-6 p-2 rounded-lg bg-background shadow-[0_8px_16px_rgba(255,107,0,0.2),_inset_0_0_8px_rgba(255,107,0,0.1)] border border-accent-orange/50",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"title",children:"Product Title"}),e.jsx(m,{id:"title",...u("title")}),r.title&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.title.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"shortDescription",children:"Short Description (max 500 chars)"}),e.jsx(E,{id:"shortDescription",...u("shortDescription"),rows:3,maxLength:500}),r.shortDescription&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.shortDescription.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"fullDescription",children:"Full Description"}),e.jsx(E,{id:"fullDescription",...u("fullDescription"),rows:6}),r.fullDescription&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.fullDescription.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"price",children:"Price (USD)"}),e.jsx(m,{id:"price",type:"number",step:"0.01",...u("price")}),r.price&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.price.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"discountCode",children:"Discount or Promo Code (Optional)"}),e.jsx(m,{id:"discountCode",...u("discountCode")})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"guaranteeWarranty",children:"Guarantee or Warranty"}),e.jsx(X,{name:"guaranteeWarranty",control:O,render:({field:t})=>e.jsxs(z,{onValueChange:t.onChange,value:t.value,children:[e.jsx(Y,{children:e.jsx(Z,{placeholder:"Select guarantee/warranty"})}),e.jsx(q,{children:ne.map(s=>e.jsx(J,{value:s.value,children:s.label},s.value))})]})}),r.guaranteeWarranty&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.guaranteeWarranty.message})]}),e.jsxs("div",{children:[e.jsxs(o,{children:["Product Images (up to ",b,", max ",P,"MB each)"]}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md border-accent-orange/30 hover:border-accent-orange transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(be,{className:"mx-auto h-10 w-10 text-muted-foreground"}),e.jsxs("div",{className:"flex text-sm text-muted-foreground",children:[e.jsxs("label",{htmlFor:"productImages",className:"relative cursor-pointer rounded-md font-medium text-accent-orange hover:text-accent-orange/80",children:[e.jsx("span",{children:"Upload files"}),e.jsx(m,{id:"productImages",type:"file",className:"sr-only",multiple:!0,onChange:se,accept:"image/*"})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["PNG, JPG, GIF up to ",P,"MB"]})]})}),N.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:N.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`Preview ${s+1}`,className:"h-32 w-full object-cover rounded-md shadow-md"}),e.jsx(w,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full opacity-0 group-hover:opacity-100",onClick:()=>re(s),children:e.jsx(k,{className:"h-4 w-4"})})]},s))})]}),e.jsxs("div",{children:[e.jsxs(o,{children:["Product Video (Optional, max ",F,"MB)"]}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md border-accent-orange/30 hover:border-accent-orange transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(Ne,{className:"mx-auto h-10 w-10 text-muted-foreground"}),e.jsxs("div",{className:"flex text-sm text-muted-foreground",children:[e.jsxs("label",{htmlFor:"productVideo",className:"relative cursor-pointer rounded-md font-medium text-accent-orange hover:text-accent-orange/80",children:[e.jsx("span",{children:I||"Upload a video"}),e.jsx(m,{id:"productVideo",type:"file",className:"sr-only",onChange:ie,accept:"video/*"})]}),I&&e.jsx("p",{className:"pl-1",children:"selected"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["MP4, MOV, AVI up to ",F,"MB"]})]})}),I&&e.jsxs("div",{className:"mt-2 flex items-center justify-between p-2 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm text-foreground truncate",children:I}),e.jsx(w,{type:"button",variant:"ghost",size:"icon",onClick:G,className:"text-destructive hover:text-destructive/80",children:e.jsx(k,{className:"h-4 w-4"})})]}),e.jsx(o,{htmlFor:"videoUrl",className:"mt-2 block",children:"Or provide video URL (e.g., YouTube, Vimeo)"}),e.jsx(m,{id:"videoUrl",...u("videoUrl"),placeholder:"https://youtube.com/watch?v=yourvideo"}),r.videoUrl&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.videoUrl.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"accessLinkAfterPurchase",children:"Access Link / Registration Link (Optional)"}),e.jsx(m,{id:"accessLinkAfterPurchase",...u("accessLinkAfterPurchase"),placeholder:"https://yourproduct.com/access"}),r.accessLinkAfterPurchase&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.accessLinkAfterPurchase.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"categoryId",children:"Category"}),e.jsx(X,{name:"categoryId",control:O,render:({field:t})=>e.jsxs(z,{onValueChange:t.onChange,value:t.value,children:[e.jsx(Y,{children:e.jsx(Z,{placeholder:"Select product category"})}),e.jsx(q,{children:H.map(s=>e.jsx(J,{value:String(s.id),children:s.name},s.id))})]})}),r.categoryId&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.categoryId.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"tags",children:"Tags (max 10)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{id:"currentTag",value:U,onChange:t=>R(t.target.value),placeholder:"e.g., AI, SaaS"}),e.jsxs(w,{type:"button",variant:"outline",onClick:ae,className:"border-accent-orange text-accent-orange hover:bg-accent-orange/10",children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"})," Add"]})]}),p("tags").length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:p("tags").map(t=>e.jsxs("span",{className:"flex items-center bg-accent-orange/10 text-accent-orange text-xs font-medium px-2.5 py-0.5 rounded-full",children:[t,e.jsx("button",{type:"button",onClick:()=>oe(t),className:"ml-1.5 text-accent-orange/70 hover:text-accent-orange",children:e.jsx(k,{className:"h-3 w-3"})})]},t))}),r.tags&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.tags.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"productFileUrl",children:"Product File URL (Optional)"}),e.jsx(m,{id:"productFileUrl",...u("productFileUrl"),placeholder:"https://yourstorage.com/product.zip"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"If not providing a direct file URL, use access link or delivery instructions."}),r.productFileUrl&&r.productFileUrl.type!=="refinement"&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.productFileUrl.message})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"deliveryInstructions",children:"Access/Delivery Instructions (Optional)"}),e.jsx(E,{id:"deliveryInstructions",...u("deliveryInstructions"),rows:3,placeholder:"e.g., After purchase, you will receive an email..."}),r.deliveryInstructions&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.deliveryInstructions.message})]}),r.productFileUrl&&r.productFileUrl.type==="refinement"&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:r.productFileUrl.message}),e.jsxs("div",{className:"space-y-2 pt-4 border-t border-accent-orange/30",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{id:"agreeToCommission",checked:p("agreeToCommission"),onCheckedChange:t=>L("agreeToCommission",t)}),e.jsx(o,{htmlFor:"agreeToCommission",className:"cursor-pointer",children:"I agree to Boogasi Seller Terms & 25% Commission."})]}),r.agreeToCommission&&e.jsx("p",{className:"text-sm text-destructive",children:r.agreeToCommission.message})]}),e.jsxs(w,{type:"submit",className:"w-full bg-accent-orange hover:bg-accent-orange/90 text-accent-orange-foreground",disabled:V,children:[V&&e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Product"]})]})};export{Me as P};
