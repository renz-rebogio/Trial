import{K as ze,a2 as W,u as o,j as e,a3 as Le,a4 as Ie,P as X,a5 as Ye,a6 as Be,O as Ue,a7 as He,a8 as Ge,a9 as J,aa as Ve,ab as Ke,ac as We,R as P,_ as x,ad as Q,E as Xe,G as Je,w as Qe,x as c,q as Ze,a as y,z as et,ae as tt,$ as st}from"./index-b765cb56.js";import{C as _,a as D,b as A,c as S,d as q,e as at}from"./card-e310dec2.js";import{T as rt,a as lt,b as z,c as L}from"./tabs-a08e3c6f.js";import{P as it,T as ot,U as nt}from"./UserNotesSection-4b0a60ea.js";import{P as ct}from"./plus-circle-8f4a9924.js";import{E as dt}from"./eye-182bb5f4.js";import{P as K}from"./package-6fe4c251.js";import{X as mt}from"./x-circle-003a14ef.js";import"./textarea-963d3648.js";var Z="AlertDialog",[ht,Mt]=ze(Z,[W]),u=W(),ee=r=>{const{__scopeAlertDialog:a,...s}=r,i=u(a);return e.jsx(Ve,{...i,...s,modal:!0})};ee.displayName=Z;var pt="AlertDialogTrigger",te=o.forwardRef((r,a)=>{const{__scopeAlertDialog:s,...i}=r,n=u(s);return e.jsx(Le,{...n,...i,ref:a})});te.displayName=pt;var ut="AlertDialogPortal",se=r=>{const{__scopeAlertDialog:a,...s}=r,i=u(a);return e.jsx(Ke,{...i,...s})};se.displayName=ut;var gt="AlertDialogOverlay",ae=o.forwardRef((r,a)=>{const{__scopeAlertDialog:s,...i}=r,n=u(s);return e.jsx(Ie,{...n,...i,ref:a})});ae.displayName=gt;var C="AlertDialogContent",[xt,ft]=ht(C),vt=We("AlertDialogContent"),re=o.forwardRef((r,a)=>{const{__scopeAlertDialog:s,children:i,...n}=r,f=u(s),j=o.useRef(null),b=X(a,j),R=o.useRef(null);return e.jsx(Ye,{contentName:C,titleName:le,docsSlug:"alert-dialog",children:e.jsx(xt,{scope:s,cancelRef:R,children:e.jsxs(Be,{role:"alertdialog",...f,...n,ref:b,onOpenAutoFocus:Ue(n.onOpenAutoFocus,v=>{var h;v.preventDefault(),(h=R.current)==null||h.focus({preventScroll:!0})}),onPointerDownOutside:v=>v.preventDefault(),onInteractOutside:v=>v.preventDefault(),children:[e.jsx(vt,{children:i}),e.jsx(jt,{contentRef:j})]})})})});re.displayName=C;var le="AlertDialogTitle",ie=o.forwardRef((r,a)=>{const{__scopeAlertDialog:s,...i}=r,n=u(s);return e.jsx(He,{...n,...i,ref:a})});ie.displayName=le;var oe="AlertDialogDescription",ne=o.forwardRef((r,a)=>{const{__scopeAlertDialog:s,...i}=r,n=u(s);return e.jsx(Ge,{...n,...i,ref:a})});ne.displayName=oe;var Nt="AlertDialogAction",ce=o.forwardRef((r,a)=>{const{__scopeAlertDialog:s,...i}=r,n=u(s);return e.jsx(J,{...n,...i,ref:a})});ce.displayName=Nt;var de="AlertDialogCancel",me=o.forwardRef((r,a)=>{const{__scopeAlertDialog:s,...i}=r,{cancelRef:n}=ft(de,s),f=u(s),j=X(a,n);return e.jsx(J,{...f,...i,ref:j})});me.displayName=de;var jt=({contentRef:r})=>{const a=`\`${C}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${C}\` by passing a \`${oe}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${C}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return o.useEffect(()=>{var i;document.getElementById((i=r.current)==null?void 0:i.getAttribute("aria-describedby"))||console.warn(a)},[a,r]),null},bt=ee,wt=te,yt=se,he=ae,pe=re,ue=ce,ge=me,xe=ie,fe=ne;const _t=bt,Dt=wt,At=yt,ve=P.forwardRef(({className:r,...a},s)=>e.jsx(he,{className:x("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...a,ref:s}));ve.displayName=he.displayName;const Ne=P.forwardRef(({className:r,...a},s)=>e.jsxs(At,{children:[e.jsx(ve,{}),e.jsx(pe,{ref:s,className:x("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg","glassmorphic",r),...a})]}));Ne.displayName=pe.displayName;const je=({className:r,...a})=>e.jsx("div",{className:x("flex flex-col space-y-2 text-center sm:text-left",r),...a});je.displayName="AlertDialogHeader";const be=({className:r,...a})=>e.jsx("div",{className:x("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...a});be.displayName="AlertDialogFooter";const we=P.forwardRef(({className:r,...a},s)=>e.jsx(xe,{ref:s,className:x("text-lg font-semibold",r),...a}));we.displayName=xe.displayName;const ye=P.forwardRef(({className:r,...a},s)=>e.jsx(fe,{ref:s,className:x("text-sm text-muted-foreground",r),...a}));ye.displayName=fe.displayName;const _e=P.forwardRef(({className:r,...a},s)=>e.jsx(ue,{ref:s,className:x(Q(),r),...a}));_e.displayName=ue.displayName;const De=P.forwardRef(({className:r,...a},s)=>e.jsx(ge,{ref:s,className:x(Q({variant:"outline"}),"mt-2 sm:mt-0",r),...a}));De.displayName=ge.displayName;const I="boogasi",Ft=()=>{const{user:r}=Xe(),a=Je(),{toast:s}=Qe(),[i,n]=o.useState(null),[f,j]=o.useState([]),[b,R]=o.useState([]),[v,h]=o.useState(!0),[d,Y]=o.useState(null),[Ae,k]=o.useState(!1),[E,B]=o.useState(null),[$,O]=o.useState(""),[M,F]=o.useState(""),[Se,U]=o.useState(!1),[Ce,Pe]=o.useState([]),[T,H]=o.useState([]),w=o.useCallback(async()=>{if(!r){a("/auth?type=login&redirect=/seller-dashboard");return}h(!0);try{const{data:t,error:l}=await c.from("sellers").select("*").eq("user_id",r.id).maybeSingle();if(l&&l.code!=="PGRST116")throw l;if(!t){s({variant:"warning",title:"Seller Account Not Found",description:"Please complete your seller registration."}),a("/sell-on-boogasi"),h(!1);return}n(t);const{data:p,error:g}=await c.from("digital_products").select(`
              id, title, price, status, 
              digital_product_categories (name), 
              digital_product_images (id, image_url, alt_text)
            `).eq("seller_id",t.id).order("created_at",{ascending:!1});if(g)throw g;j(p||[]);const{data:m,error:N}=await c.from("digital_product_sales").select("*, digital_products (title)").eq("seller_id",t.id).order("sale_date",{ascending:!1});if(N)throw N;R(m||[]);const{data:qe,error:V}=await c.from("user_notes").select("*").eq("user_id",r.id).order("updated_at",{ascending:!1});if(V)throw V;Pe(qe||[])}catch(t){s({variant:"destructive",title:"Error loading dashboard",description:t.message})}finally{h(!1)}},[r,a,s]);o.useEffect(()=>{w()},[w]);const Ee=async()=>{if(!(!d||!d.id)){h(!0);try{const{data:t,error:l}=await c.from("digital_product_images").select("image_url").eq("product_id",d.id);if(l)throw l;if(t&&t.length>0){const g=t.map(m=>{try{const N=new URL(m.image_url);return N.pathname.substring(N.pathname.indexOf(I)+I.length+1)}catch(N){return console.warn("Invalid image URL for deletion:",m.image_url,N),null}}).filter(m=>m!==null);if(g.length>0){const{error:m}=await c.storage.from(I).remove(g);m&&console.warn("Error deleting files from storage, proceeding with DB deletion:",m.message)}}await c.from("digital_product_images").delete().eq("product_id",d.id),await c.from("digital_product_sales").delete().eq("product_id",d.id),await c.from("posts").update({digital_product_id:null}).eq("digital_product_id",d.id);const{error:p}=await c.from("digital_products").delete().eq("id",d.id);if(p)throw p;s({title:"Product Deleted",description:`"${d.title}" has been removed.`}),w()}catch(t){s({variant:"destructive",title:"Deletion Failed",description:t.message})}finally{Y(null),h(!1)}}},Te=()=>{B(null),O(""),F(""),k(!0)},Re=t=>{var l;B(t),O(t.title),F(((l=t.content)==null?void 0:l.text)||""),k(!0)},ke=async()=>{if(!$.trim()||!M.trim()){s({variant:"destructive",title:"Cannot save note",description:"Title and content are required."});return}U(!0);try{const t={user_id:r.id,title:$,content:{text:M}};if(E!=null&&E.id){const{error:l}=await c.from("user_notes").update(t).eq("id",E.id);if(l)throw l;s({title:"Note Updated",description:"Your note has been saved."})}else{const{error:l}=await c.from("user_notes").insert(t);if(l)throw l;s({title:"Note Saved",description:"Your new note has been created."})}k(!1),w()}catch(t){s({variant:"destructive",title:"Error Saving Note",description:t.message})}finally{U(!1)}},$e=async t=>{try{const{error:l}=await c.from("user_notes").delete().eq("id",t);if(l)throw l;s({title:"Note Deleted",description:"The note has been removed."}),w()}catch(l){s({variant:"destructive",title:"Error Deleting Note",description:l.message})}},Oe=t=>{H(l=>l.includes(t)?l.filter(p=>p!==t):[...l,t])},G=async t=>{if(T.length===0){s({title:"No Products Selected",description:"Please select products to perform this action."});return}h(!0);const l=t==="approve"?"active":"rejected";try{const p=T.map(m=>({id:m,status:l})),{error:g}=await c.from("digital_products").upsert(p);if(g)throw g;s({title:"Bulk Action Complete",description:`Selected products have been ${t==="approve"?"approved":"rejected"}.`}),H([]),w()}catch(p){s({variant:"destructive",title:"Bulk Action Failed",description:p.message})}finally{h(!1)}};if(v)return e.jsx("div",{className:"flex justify-center items-center h-screen brighter-theme-area",children:e.jsx(Ze,{className:"h-12 w-12 animate-spin text-[hsl(var(--brighter-blue))]"})});if(!i)return e.jsx("div",{className:"text-center py-10 brighter-theme-area",children:"Redirecting..."});const Me=b.reduce((t,l)=>t+parseFloat(l.seller_payout_amount||0),0),Fe=b.length;return e.jsxs("div",{className:"container mx-auto py-8 px-4 brighter-theme-area min-h-screen",children:[" ",e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-8 gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-[hsl(var(--brighter-blue))]",children:"Seller Dashboard"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{onClick:()=>a("/seller/list-product"),className:"bg-[hsl(var(--brighter-blue))] hover:bg-[hsl(var(--brighter-blue))]/90 text-primary-foreground",children:[e.jsx(ct,{className:"mr-2 h-4 w-4"})," List New Product"]}),e.jsxs(y,{variant:"outline",onClick:()=>a(`/store/${i.id}`),className:"border-[hsl(var(--brighter-teal))] text-[hsl(var(--brighter-teal))] hover:bg-[hsl(var(--brighter-teal))]/10",children:[e.jsx(dt,{className:"mr-2 h-4 w-4"})," View My Storefront"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(_,{className:"shadow-xl",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Total Revenue"}),e.jsx(et,{className:"h-4 w-4"})]}),e.jsxs(S,{children:[e.jsxs("div",{className:"text-2xl font-bold text-[hsl(var(--brighter-green))]",children:["$",Me.toFixed(2)]}),e.jsx("p",{className:"text-xs",children:"Net earnings after 25% commission"})]})]}),e.jsxs(_,{className:"shadow-xl",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Total Sales"}),e.jsx(K,{className:"h-4 w-4"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold text-[hsl(var(--brighter-teal))]",children:Fe}),e.jsx("p",{className:"text-xs",children:"Number of products sold"})]})]}),e.jsxs(_,{className:"shadow-xl",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium",children:"Account Status"}),e.jsx(tt,{className:"h-4 w-4"})]}),e.jsxs(S,{children:[e.jsx("div",{className:`text-2xl font-bold capitalize ${i.status==="active"?"text-[hsl(var(--brighter-green))]":"text-[hsl(var(--brighter-yellow))]"}`,children:i.status.replace("_"," ")}),e.jsx("p",{className:"text-xs",children:"Your seller account standing"})]})]})]}),e.jsxs(rt,{defaultValue:"products",children:[e.jsxs(lt,{className:"grid w-full grid-cols-3 md:w-auto md:inline-flex mb-6 shadow-lg backdrop-blur-sm",children:[" ",e.jsx(z,{value:"products",children:"My Products"})," ",e.jsx(z,{value:"sales",children:"Sales History"}),e.jsx(z,{value:"notes",children:"My Notes"})]}),e.jsx(L,{value:"products",children:e.jsxs(_,{className:"shadow-xl",children:[" ",e.jsxs(D,{children:[e.jsx(A,{children:"Your Digital Products"}),e.jsx(q,{children:"Manage your product listings. (Admin approval actions enabled for testing)"})]}),e.jsxs(S,{children:[f.length>0&&e.jsxs("div",{className:"mb-4 flex space-x-2",children:[e.jsxs(y,{size:"sm",onClick:()=>G("approve"),disabled:T.length===0,className:"bg-[hsl(var(--brighter-green))] hover:bg-[hsl(var(--brighter-green))]/90 text-primary-foreground",children:[e.jsx(st,{className:"mr-1 h-4 w-4"}),"Approve Selected"]}),e.jsxs(y,{size:"sm",variant:"destructive",onClick:()=>G("reject"),disabled:T.length===0,className:"bg-[hsl(var(--brighter-pink))] hover:bg-[hsl(var(--brighter-pink))]/90",children:[e.jsx(mt,{className:"mr-1 h-4 w-4"}),"Reject Selected"]})]}),f.length===0?e.jsx("p",{className:"text-center py-8",children:"You haven't listed any products yet."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(t=>{var l;return e.jsxs(_,{className:"flex flex-col overflow-hidden group shadow-lg hover:shadow-[hsl(var(--brighter-blue))]/30 transition-shadow duration-300",children:[" ",e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",className:"absolute top-2 left-2 h-5 w-5 z-10 accent-[hsl(var(--brighter-blue))] rounded",checked:T.includes(t.id),onChange:()=>Oe(t.id)}),t.digital_product_images&&t.digital_product_images.length>0?e.jsx("img",{src:t.digital_product_images[0].image_url,alt:t.digital_product_images[0].alt_text||t.title,className:"h-48 w-full object-cover transition-transform duration-300 group-hover:scale-105"}):e.jsx("div",{className:"h-48 w-full flex items-center justify-center",children:e.jsx(K,{className:"h-16 w-16"})})]}),e.jsxs(D,{className:"pb-2",children:[e.jsx(A,{className:"text-lg truncate group-hover:text-[hsl(var(--brighter-blue))]",children:t.title}),e.jsx(q,{className:"text-xs",children:((l=t.digital_product_categories)==null?void 0:l.name)||"N/A"})]}),e.jsxs(S,{className:"flex-grow text-sm",children:[e.jsxs("p",{children:["Price: ",e.jsxs("span",{className:"font-semibold text-[hsl(var(--brighter-green))]",children:["$",t.price]})]}),e.jsxs("p",{children:["Status: ",e.jsx("span",{className:`capitalize font-medium ${t.status==="active"?"text-[hsl(var(--brighter-green))]":t.status==="rejected"?"text-[hsl(var(--brighter-pink))]":"text-[hsl(var(--brighter-yellow))]"}`,children:t.status.replace("_"," ")})]})]}),e.jsxs(at,{className:"flex justify-end space-x-2 p-3",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>a(`/seller/edit-product/${t.id}`),disabled:!0,className:"border-[hsl(var(--brighter-teal))] text-[hsl(var(--brighter-teal))] hover:bg-[hsl(var(--brighter-teal))]/10",children:[e.jsx(it,{className:"mr-1 h-3 w-3"})," Edit"]}),e.jsxs(_t,{children:[e.jsx(Dt,{asChild:!0,children:e.jsx(y,{variant:"destructive",size:"sm",onClick:()=>Y(t),className:"bg-[hsl(var(--brighter-pink))] hover:bg-[hsl(var(--brighter-pink))]/90",children:e.jsx(ot,{className:"mr-1 h-3 w-3"})})}),e.jsxs(Ne,{children:[" ",e.jsxs(je,{children:[e.jsx(we,{children:"Are you sure?"}),e.jsxs(ye,{children:['This will permanently delete "$',d==null?void 0:d.title,'". This action cannot be undone.']})]}),e.jsxs(be,{children:[e.jsx(De,{className:"border-[hsl(var(--brighter-teal))] text-[hsl(var(--brighter-teal))] hover:bg-[hsl(var(--brighter-teal))]/10",children:"Cancel"}),e.jsx(_e,{onClick:Ee,className:"bg-[hsl(var(--brighter-pink))] hover:bg-[hsl(var(--brighter-pink))]/90 text-primary-foreground",children:"Delete"})]})]})]})]})]},t.id)})})]})]})}),e.jsx(L,{value:"sales",children:e.jsxs(_,{className:"shadow-xl",children:[" ",e.jsxs(D,{children:[e.jsx(A,{children:"Your Sales History"}),e.jsx(q,{children:"Overview of all your product sales (25% platform commission applied)."})]}),e.jsx(S,{children:b.length===0?e.jsx("p",{children:"No sales recorded yet."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y",children:[e.jsx("thead",{className:"bg-muted/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider",children:"Sale Price"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider",children:"Commission (25%)"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider",children:"Your Payout (75%)"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y",children:b.map(t=>{var l;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:new Date(t.sale_date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:((l=t.digital_products)==null?void 0:l.title)||"N/A"}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:["$",parseFloat(t.sale_price||0).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-[hsl(var(--brighter-pink))]",children:["-$",parseFloat(t.commission_amount||0).toFixed(2)]}),e.jsxs("td",{className:"px-3 whitespace-nowrap text-sm text-[hsl(var(--brighter-green))]",children:["$",parseFloat(t.seller_payout_amount||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm capitalize",children:t.status})]},t.id)})})]})})})]})}),e.jsx(L,{value:"notes",children:e.jsx(nt,{userNotes:Ce,isNoteModalOpen:Ae,setIsNoteModalOpen:k,currentNote:E,noteTitle:$,setNoteTitle:O,noteContent:M,setNoteContent:F,handleSaveNote:ke,savingNote:Se,handleOpenNewNoteModal:Te,handleOpenEditNoteModal:Re,handleDeleteNote:$e})})]})]})};export{Ft as default};
