import{c as _e,w as K,u as i,x as F,E as de,j as e,p as _,I as B,a as y,q as Z,m as O,z as ne,U as Ie,H as me,D as R,l as z,n as G,o as Y,s as q,t as X,X as Me,G as Le,k as Fe}from"./index-b765cb56.js";import{o as Ae,s as H,p as $e,n as Ee,b as Te,u as De,C as Be,t as Pe}from"./types-91e76d5d.js";import{T as ge}from"./textarea-963d3648.js";import{S as he,a as ue,b as pe,c as xe,d as J}from"./select-4b66b67e.js";import{C as Ue}from"./checkbox-1788842e.js";import{U as Re}from"./upload-cloud-d777fa41.js";import{X as ze}from"./x-circle-003a14ef.js";import{S as Ge}from"./slider-d6b3f068.js";import{S as Ye}from"./search-6c0c5f62.js";import{C as qe,a as Oe,b as Ve,d as Xe,c as He,e as Ze}from"./card-e310dec2.js";import{M as Je}from"./message-square-b4049029.js";import{C as Ke}from"./check-circle-09be6f02.js";import{L as ce}from"./lock-69a1ac57.js";import{P as We}from"./plus-circle-8f4a9924.js";import"./index-3d40f662.js";const Qe=_e("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]),U=5,be=2,ea=be*1024*1024,aa=(a,j)=>{const{toast:s}=K(),[h,m]=i.useState([]),[d,g]=i.useState([]),p=i.useCallback(l=>{const b=Array.from(l.target.files),v=[],t=[];b.forEach(o=>{if(h.length+v.length>=U){s({variant:"destructive",title:"Image Limit",description:`Max ${U} images.`});return}if(o.size>ea){s({variant:"destructive",title:"File Too Large",description:`Image "${o.name}" exceeds ${be}MB.`});return}if(!o.type.startsWith("image/")){s({variant:"destructive",title:"Invalid File Type",description:`"${o.name}" is not an image.`});return}v.push(o),t.push(URL.createObjectURL(o))}),m(o=>[...o,...v].slice(0,U)),g(o=>[...o,...t].slice(0,U)),l.target&&(l.target.value=null)},[h.length,s]),C=i.useCallback(l=>{URL.revokeObjectURL(d[l]),m(b=>b.filter((v,t)=>t!==l)),g(b=>b.filter((v,t)=>t!==l))},[d]),w=i.useCallback(()=>{d.forEach(l=>URL.revokeObjectURL(l)),m([]),g([])},[d]),x=i.useCallback(async(l,b)=>{if(h.length===0)return[];const v=`${j}/${b}`,t=[];for(const o of h){const u=`${v}/${l}/${Date.now()}-${o.name.replace(/\s+/g,"_")}`;try{const{data:k,error:I}=await F.storage.from(a).upload(u,o,{cacheControl:"3600",upsert:!1,contentType:o.type});if(I)throw I;const{data:M}=F.storage.from(a).getPublicUrl(k.path);t.push({listing_id:l,image_url:M.publicUrl,alt_text:o.name})}catch(k){console.error("Error uploading image to Supabase Storage:",k),s({variant:"destructive",title:"Image Upload Failed",description:`Could not upload ${o.name}. ${k.message}`})}}return t},[h,a,j,s]);return{listingImages:h,imagePreviews:d,handleImageUpload:p,removeImage:C,resetImages:w,uploadListingImagesToStorage:x}},sa="boogasi",ta=Ae({title:H().min(5,"Title must be at least 5 characters").max(100),description:H().min(20,"Description must be at least 20 characters").max(5e3),amount_sought:$e(a=>parseFloat(String(a)),Ee({invalid_type_error:"Amount must be a number"}).positive("Amount must be positive")),category_id:H().min(1,"Please select a category"),marketing_fee_agreed:Te().refine(a=>a===!0,{message:"You must agree to the marketing fee."})}),ra=({onSuccess:a})=>{const{user:j}=de(),{toast:s}=K(),[h,m]=i.useState(!1),[d,g]=i.useState([]),{listingImages:p,imagePreviews:C,handleImageUpload:w,removeImage:x,resetImages:l,uploadListingImagesToStorage:b}=aa(sa,"investment-listings"),{register:v,handleSubmit:t,control:o,formState:{errors:u},setValue:k,watch:I,reset:M}=De({resolver:Pe(ta),defaultValues:{title:"",description:"",amount_sought:"",category_id:"",marketing_fee_agreed:!1}});i.useEffect(()=>{(async()=>{const{data:r,error:n}=await F.from("categories").select("id, name").order("name");n?s({variant:"destructive",title:"Error fetching categories",description:n.message}):g(r||[])})()},[s]);const V=async f=>{if(!j){s({variant:"destructive",title:"Not Authenticated",description:"You must be logged in to create a listing."});return}m(!0);try{const{data:r,error:n}=await F.from("listings").insert({user_id:j.profile.id,title:f.title,description:f.description,amount_sought:f.amount_sought,category_id:f.category_id,status:"open"}).select().single();if(n)throw n;const A=await b(r.id,j.id);if(A.length>0){const E=A.map($=>F.from("listing_images").insert($));(await Promise.all(E)).forEach($=>{$.error&&console.warn("Error inserting image record:",$.error.message)})}s({title:"Listing Created!",description:`${f.title} is now live.`}),M(),l(),a&&a()}catch(r){s({variant:"destructive",title:"Listing Creation Failed",description:r.message})}finally{m(!1)}};return e.jsxs("form",{onSubmit:t(V),className:"space-y-6 py-4 max-h-[70vh] overflow-y-auto pr-2",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"title",className:"text-foreground",children:"Project Title"}),e.jsx(B,{id:"title",...v("title"),className:"bg-input border-border focus:border-[hsl(var(--brighter-blue))] focus:ring-[hsl(var(--brighter-blue))]"}),u.title&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:u.title.message})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"description",className:"text-foreground",children:"Project Description"}),e.jsx(ge,{id:"description",...v("description"),rows:5,className:"bg-input border-border focus:border-[hsl(var(--brighter-blue))] focus:ring-[hsl(var(--brighter-blue))]"}),u.description&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:u.description.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"amount_sought",className:"text-foreground",children:"Amount Sought (USD)"}),e.jsx(B,{id:"amount_sought",type:"number",step:"100",...v("amount_sought"),className:"bg-input border-border focus:border-[hsl(var(--brighter-blue))] focus:ring-[hsl(var(--brighter-blue))]"}),u.amount_sought&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:u.amount_sought.message})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"category_id",className:"text-foreground",children:"Category"}),e.jsx(Be,{name:"category_id",control:o,render:({field:f})=>e.jsxs(he,{onValueChange:f.onChange,value:f.value,children:[e.jsx(ue,{className:"bg-input border-border text-foreground focus:border-[hsl(var(--brighter-blue))] focus:ring-[hsl(var(--brighter-blue))]",children:e.jsx(pe,{placeholder:"Select project category"})}),e.jsx(xe,{className:"bg-popover text-popover-foreground border-[hsl(var(--brighter-teal))]",children:d.map(r=>e.jsx(J,{value:String(r.id),children:r.name},r.id))})]})}),u.category_id&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:u.category_id.message})]})]}),e.jsxs("div",{children:[e.jsx(_,{className:"text-foreground",children:"Project Images (up to 5, max 2MB each)"}),e.jsx("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md border-border hover:border-[hsl(var(--brighter-blue))] transition-colors",children:e.jsxs("div",{className:"space-y-1 text-center",children:[e.jsx(Re,{className:"mx-auto h-10 w-10 text-muted-foreground"}),e.jsxs("div",{className:"flex text-sm text-muted-foreground",children:[e.jsxs("label",{htmlFor:"listingImages",className:"relative cursor-pointer rounded-md font-medium text-[hsl(var(--brighter-pink))] hover:text-[hsl(var(--brighter-pink))]/80",children:[e.jsx("span",{children:"Upload files"}),e.jsx(B,{id:"listingImages",type:"file",className:"sr-only",multiple:!0,onChange:w,accept:"image/*"})]}),e.jsx("p",{className:"pl-1",children:"or drag and drop"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG, GIF up to 2MB"})]})}),C.length>0&&e.jsx("div",{className:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:C.map((f,r)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:f,alt:`Preview ${r+1}`,className:"h-24 w-full object-cover rounded-md shadow-md"}),e.jsx(y,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full opacity-0 group-hover:opacity-100 bg-[hsl(var(--brighter-pink))] hover:bg-[hsl(var(--brighter-pink))]/80",onClick:()=>x(r),children:e.jsx(ze,{className:"h-4 w-4"})})]},r))})]}),e.jsxs("div",{className:"space-y-2 p-3 border rounded-md bg-muted/30 border-[hsl(var(--brighter-teal))]/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground font-semibold",children:"Seller's Agreement & Marketing Fee:"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"By creating this listing, you agree that if an offer is accepted, a 25% marketing fee of the accepted offer amount will be payable to Boogasi LLC upon deal commitment."}),e.jsxs("div",{className:"flex items-center space-x-2 pt-1",children:[e.jsx(Ue,{id:"marketing_fee_agreed",checked:I("marketing_fee_agreed"),onCheckedChange:f=>k("marketing_fee_agreed",f),className:"border-[hsl(var(--brighter-blue))] data-[state=checked]:bg-[hsl(var(--brighter-blue))]"}),e.jsx(_,{htmlFor:"marketing_fee_agreed",className:"cursor-pointer text-xs text-foreground",children:"I agree to the 25% marketing fee terms."})]}),u.marketing_fee_agreed&&e.jsx("p",{className:"text-sm text-destructive",children:u.marketing_fee_agreed.message})]}),e.jsxs(y,{type:"submit",className:"w-full bg-gradient-to-r from-[hsl(var(--brighter-blue))] to-[hsl(var(--brighter-teal))] text-primary-foreground hover:opacity-90",disabled:h,children:[h&&e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Listing"]})]})},oa=({searchTerm:a,setSearchTerm:j,selectedCategoryFilter:s,setSelectedCategoryFilter:h,categories:m,amountRangeFilter:d,setAmountRangeFilter:g})=>e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end p-4 border rounded-lg bg-transparent shadow",children:[e.jsxs("div",{className:"relative flex-grow lg:col-span-1",children:[e.jsx(_,{htmlFor:"search-projects",className:"text-sm text-muted-foreground mb-1 block",children:"Search"}),e.jsx(Ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground mt-3"}),e.jsx(B,{id:"search-projects",type:"search",placeholder:"Search projects, categories...",className:"pl-10 w-full h-12 bg-input border-border focus:border-[hsl(var(--brighter-blue))] focus:ring-[hsl(var(--brighter-blue))]",value:a,onChange:p=>j(p.target.value)})]}),e.jsxs("div",{className:"flex-grow lg:col-span-1",children:[e.jsx(_,{htmlFor:"category-filter",className:"text-sm text-muted-foreground mb-1 block",children:"Category"}),e.jsxs(he,{value:s,onValueChange:h,children:[e.jsx(ue,{id:"category-filter",className:"w-full h-12 bg-input border-border text-foreground focus:border-[hsl(var(--brighter-blue))] focus:ring-[hsl(var(--brighter-blue))]",children:e.jsx(pe,{placeholder:"Filter by Category"})}),e.jsxs(xe,{className:"bg-popover text-popover-foreground border-[hsl(var(--brighter-teal))]",children:[e.jsx(J,{value:"all",children:"All Categories"}),m.map(p=>e.jsx(J,{value:String(p.id),children:p.name},p.id))]})]})]}),e.jsxs("div",{className:"flex-grow lg:col-span-1",children:[e.jsxs(_,{className:"text-sm text-muted-foreground mb-1 block",children:["Amount Sought: ",e.jsxs("span",{className:"text-[hsl(var(--brighter-green))]",children:["$",d[0].toLocaleString()]})," - ",e.jsxs("span",{className:"text-[hsl(var(--brighter-green))]",children:["$",d[1].toLocaleString()]})]}),e.jsx(Ge,{min:0,max:1e6,step:1e4,value:d,onValueChange:g,className:"h-12 flex items-center [&>span:first-child]:bg-[hsl(var(--brighter-green))] [&_[role=slider]]:bg-[hsl(var(--brighter-pink))] [&_[role=slider]]:border-[hsl(var(--brighter-pink))]"})]})]}),ia=({listing:a,index:j,user:s,onContact:h,onOffer:m,onManageOffer:d})=>{var C,w;const g={hidden:{opacity:0,scale:.95,y:20},visible:x=>({opacity:1,scale:1,y:0,transition:{delay:x*.07,duration:.4}})},p=a.bids&&a.bids.length>0;return e.jsx(O.div,{custom:j,variants:g,initial:"hidden",animate:"visible",className:"marketplace-page-container",children:e.jsxs(qe,{className:"h-full flex flex-col overflow-hidden shadow-xl hover:shadow-[hsl(var(--boogasi-cyan-val))]/40 transition-all duration-300 ease-out glassmorphic-card-hover group border-2 border-[hsl(var(--marketplace-border))] hover:border-[hsl(var(--marketplace-hover-border))] bg-[hsl(var(--marketplace-card-bg))]",children:[a.images&&a.images.length>0?e.jsxs("div",{className:"w-full h-48 overflow-hidden relative",children:[e.jsx("img",{src:a.images[0].image_url,alt:a.images[0].alt_text||a.title,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"}),e.jsx("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded-md shadow-lg",children:a.category})]}):e.jsxs("div",{className:"w-full h-48 overflow-hidden relative bg-slate-700/50 flex items-center justify-center",children:[e.jsx("img",{alt:"Abstract 3D rendering of financial data and charts",className:"w-full h-full object-cover opacity-50 group-hover:opacity-75 transition-opacity duration-300",src:"https://images.unsplash.com/photo-1681392841332-63de1b3fce46"}),e.jsx("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-1 rounded-md shadow-lg",children:a.category||"General"})]}),e.jsxs(Oe,{className:"pt-4",children:[e.jsx(Ve,{className:"text-xl leading-tight truncate group-hover:text-[hsl(var(--boogasi-blue-val))] text-slate-100",children:a.title}),e.jsx(Xe,{className:"text-xs line-clamp-2 pt-1 h-[30px] text-slate-400 group-hover:text-slate-300",children:a.description})]}),e.jsxs(He,{className:"flex-grow space-y-2 text-sm text-slate-300",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ne,{className:"h-4 w-4 mr-2 text-[hsl(var(--boogasi-green-val))]"}),e.jsxs("span",{children:["Seeking: ",e.jsxs("span",{className:"font-semibold text-[hsl(var(--boogasi-green-val))]",children:["$",(C=a.amount_sought)==null?void 0:C.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2 text-[hsl(var(--boogasi-blue-val))]"}),e.jsxs("span",{children:["By: ",e.jsx("span",{className:"font-semibold text-[hsl(var(--boogasi-blue-val))]",children:a.ownerScreenName})," ",a.ownerLocation&&`(${a.ownerLocation})`]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"h-4 w-4 mr-2 text-[hsl(var(--boogasi-orange-val))]"}),e.jsxs("span",{children:["Offers: ",e.jsx("span",{className:"font-semibold text-[hsl(var(--boogasi-orange-val))]",children:((w=a.bids)==null?void 0:w.length)||0})]})]}),s&&s.id===a.ownerId&&p&&e.jsxs("div",{className:"mt-1",children:[e.jsx("h4",{className:"text-xs font-semibold text-slate-400 mb-0.5",children:"Offers:"}),e.jsx("div",{className:"max-h-16 overflow-y-auto space-y-0.5 text-xs",children:a.bids.map(x=>{var l,b;return e.jsxs("div",{className:"flex justify-between items-center p-1 bg-slate-700/50 rounded text-slate-300",children:[e.jsxs("span",{children:[((l=x.profiles)==null?void 0:l.screen_name)||((b=x.profiles)==null?void 0:b.name)||"Bidder",": $",x.amount.toLocaleString()," (",x.status,")"]}),e.jsx(y,{size:"sm",variant:"ghost",onClick:()=>d(x,a),className:"h-5 px-1 py-0 text-xs text-[hsl(var(--boogasi-blue-val))] hover:text-[hsl(var(--boogasi-teal-val))]",children:"Manage"})]},x.id)})})]})]}),e.jsxs(Ze,{className:"grid grid-cols-2 gap-2 p-3 border-t border-[hsl(var(--marketplace-border))]",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>h(a),className:"border-[hsl(var(--boogasi-blue-val))] text-[hsl(var(--boogasi-blue-val))] hover:bg-[hsl(var(--boogasi-blue-val))]/20 hover:text-white",children:[e.jsx(Je,{className:"mr-1 h-3 w-3"})," Contact"]}),e.jsxs(y,{size:"sm",onClick:()=>m(a),className:"bg-gradient-to-r from-[hsl(var(--boogasi-orange-val))] to-[hsl(var(--boogasi-pink-val))] hover:from-[hsl(var(--boogasi-orange-val))]/90 hover:to-[hsl(var(--boogasi-pink-val))]/90 text-white",disabled:!s||s.id===a.ownerId,children:[e.jsx(ne,{className:"mr-1 h-3 w-3"})," Offer"]})]})]})},a.id)},la=({isBidModalOpen:a,setIsBidModalOpen:j,selectedListing:s,bidAmount:h,setBidAmount:m,handleBidSubmit:d,isContactModalOpen:g,setIsContactModalOpen:p,contactMessage:C,setContactMessage:w,handleContactSubmit:x,userEmail:l,isManageOfferModalOpen:b,setIsManageOfferModalOpen:v,selectedOffer:t,handleManageOffer:o})=>{var u,k,I;return e.jsxs(e.Fragment,{children:[e.jsx(R,{open:a,onOpenChange:j,children:e.jsxs(z,{className:"sm:max-w-[425px] glassmorphic bg-[hsl(var(--card))] border-[hsl(var(--boogasi-blue-val))] text-foreground",children:[e.jsxs(G,{children:[e.jsxs(Y,{className:"text-[hsl(var(--boogasi-blue-val))]",children:['Make an Offer for "',s==null?void 0:s.title,'"']}),e.jsx(q,{className:"text-muted-foreground",children:"Enter the amount you'd like to offer. All offers are binding if accepted."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(_,{htmlFor:"bid-amount",className:"text-right text-foreground",children:"Amount ($)"}),e.jsx(B,{id:"bid-amount",type:"number",value:h,onChange:M=>m(M.target.value),className:"col-span-3 bg-input border-border focus:border-[hsl(var(--boogasi-blue-val))] focus:ring-[hsl(var(--boogasi-blue-val))]",placeholder:"e.g., 5000"})]}),e.jsxs("div",{className:"col-span-4 space-y-2 mt-2 p-3 border rounded-md bg-muted/30 border-[hsl(var(--boogasi-teal-val))]/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground font-semibold",children:"Buyer's Agreement:"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"By submitting this offer, you agree that it is a binding commitment to proceed with the deal if accepted by the seller. Failure to proceed may subject you to legal action by Boogasi LLC."})]})]}),e.jsxs(X,{children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>j(!1),className:"border-[hsl(var(--boogasi-teal-val))] text-[hsl(var(--boogasi-teal-val))] hover:bg-[hsl(var(--boogasi-teal-val))]/10",children:"Cancel"}),e.jsx(y,{type:"submit",onClick:d,className:"bg-gradient-to-r from-[hsl(var(--boogasi-orange-val))] to-[hsl(var(--boogasi-pink-val))] text-primary-foreground hover:opacity-90",children:"Submit Offer"})]})]})}),e.jsx(R,{open:g,onOpenChange:p,children:e.jsxs(z,{className:"sm:max-w-[425px] glassmorphic bg-[hsl(var(--card))] border-[hsl(var(--boogasi-blue-val))] text-foreground",children:[e.jsxs(G,{children:[e.jsxs(Y,{className:"text-[hsl(var(--boogasi-blue-val))]",children:['Contact Owner of "',s==null?void 0:s.title,'"']}),e.jsxs(q,{className:"text-muted-foreground",children:["Send a message to the project owner. Your contact information (",l,") will be shared."]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsx(_,{htmlFor:"contact-message",className:"text-foreground",children:"Your Message"}),e.jsx(ge,{id:"contact-message",value:C,onChange:M=>w(M.target.value),className:"col-span-4 min-h-[100px] bg-input border-border focus:border-[hsl(var(--boogasi-blue-val))] focus:ring-[hsl(var(--boogasi-blue-val))]",placeholder:"Type your message here..."})]}),e.jsxs(X,{children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>p(!1),className:"border-[hsl(var(--boogasi-teal-val))] text-[hsl(var(--boogasi-teal-val))] hover:bg-[hsl(var(--boogasi-teal-val))]/10",children:"Cancel"}),e.jsx(y,{type:"submit",onClick:x,className:"bg-gradient-to-r from-[hsl(var(--boogasi-blue-val))] to-[hsl(var(--boogasi-teal-val))] text-primary-foreground hover:opacity-90",children:"Send Message"})]})]})}),e.jsx(R,{open:b,onOpenChange:v,children:e.jsxs(z,{className:"sm:max-w-md glassmorphic bg-[hsl(var(--card))] border-[hsl(var(--boogasi-blue-val))] text-foreground",children:[e.jsxs(G,{children:[e.jsxs(Y,{className:"text-[hsl(var(--boogasi-blue-val))]",children:['Manage Offer for "',s==null?void 0:s.title,'"']}),e.jsxs(q,{className:"text-muted-foreground",children:["Offer from: ",((u=t==null?void 0:t.profiles)==null?void 0:u.screen_name)||((k=t==null?void 0:t.profiles)==null?void 0:k.name)||"Bidder"," for ",e.jsxs("span",{className:"text-[hsl(var(--boogasi-green-val))]",children:["$",(I=t==null?void 0:t.amount)==null?void 0:I.toLocaleString()]})]})]}),e.jsxs("div",{className:"py-4 space-y-3",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Current status: ",e.jsx("span",{className:"font-semibold text-[hsl(var(--boogasi-blue-val))]",children:t==null?void 0:t.status})]}),e.jsxs("p",{className:"text-xs text-muted-foreground p-3 border rounded-md bg-muted/30 border-[hsl(var(--boogasi-teal-val))]/30",children:["Marketing Fee (25%): If you accept this offer, a marketing fee of ",e.jsxs("span",{className:"text-[hsl(var(--boogasi-orange-val))]",children:["$",(((t==null?void 0:t.amount)||0)*.25).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})," will be applicable to Boogasi LLC upon deal commitment. This fee is payable by the seller."]}),e.jsxs("div",{className:"col-span-4 space-y-2 mt-2 p-3 border rounded-md bg-muted/30 border-[hsl(var(--boogasi-teal-val))]/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground font-semibold",children:"Seller's Agreement:"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"By accepting this offer, you agree to pay the 25% marketing fee to Boogasi LLC once the deal is committed."})]})]}),e.jsxs(X,{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:[e.jsxs(y,{variant:"destructive",onClick:()=>o(t.id,"declined"),children:[e.jsx(Me,{className:"mr-2 h-4 w-4"})," Decline"]}),e.jsxs(y,{variant:"outline",onClick:()=>o(t.id,"countered"),disabled:!0,className:"border-[hsl(var(--boogasi-orange-val))] text-[hsl(var(--boogasi-orange-val))] hover:bg-[hsl(var(--boogasi-orange-val))]/10",children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"})," Counter (Soon)"]}),e.jsxs(y,{className:"bg-[hsl(var(--boogasi-green-val))] hover:bg-[hsl(var(--boogasi-green-val))]/90 col-span-2 sm:col-span-1 text-primary-foreground",onClick:()=>o(t.id,"accepted"),children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"})," Accept Offer"]})]})]})})]})},wa=()=>{const[a,j]=i.useState([]),[s,h]=i.useState(""),[m,d]=i.useState(null),[g,p]=i.useState(""),[C,w]=i.useState(!1),[x,l]=i.useState(!1),[b,v]=i.useState(!1),[t,o]=i.useState(!1),[u,k]=i.useState(null),[I,M]=i.useState(""),[V,f]=i.useState(!0),{toast:r}=K(),{user:n,loading:A}=de(),E=Le(),[W,$]=i.useState([]),[T,ve]=i.useState("all"),[P,fe]=i.useState([0,1e6]),D=i.useCallback(async()=>{if(n){f(!0);try{const{data:c,error:L}=await F.from("categories").select("id, name").order("name");if(L)throw L;$(c||[]);let N=F.from("listings").select(`
              *,
              profiles (id, screen_name, name, avatar_url, country, state_province),
              categories (name),
              listing_images (id, image_url, alt_text),
              offers (id, amount, status, bidder_id, profiles (screen_name, name))
            `).eq("status","open").order("created_at",{ascending:!1});T&&T!=="all"&&(N=N.eq("category_id",T)),N=N.gte("amount_sought",P[0]),N=N.lte("amount_sought",P[1]),s&&(N=N.or(`title.ilike.%${s}%,description.ilike.%${s}%`));const{data:Se,error:Q}=await N;if(Q)throw Q;j(Se.map(S=>{var ee,ae,se,te,re,oe,ie,le;return{...S,ownerScreenName:((ee=S.profiles)==null?void 0:ee.screen_name)||((ae=S.profiles)==null?void 0:ae.name)||"Anonymous",ownerId:(se=S.profiles)==null?void 0:se.id,ownerLocation:`${((te=S.profiles)==null?void 0:te.state_province)||""}${(re=S.profiles)!=null&&re.state_province&&((oe=S.profiles)!=null&&oe.country)?", ":""}${((ie=S.profiles)==null?void 0:ie.country)||""}`,category:((le=S.categories)==null?void 0:le.name)||"Uncategorized",bids:S.offers||[],images:S.listing_images||[]}}))}catch(c){r({variant:"destructive",title:"Error fetching data",description:c.message})}finally{f(!1)}}},[n,r,T,P,s]);i.useEffect(()=>{!A&&!n?(E("/auth?type=login&redirect=/marketplace"),r({title:"Login Required",description:"Please log in to access the marketplace.",variant:"destructive"})):n&&D()},[n,A,E,r,D]);const je=async()=>{if(!n){r({variant:"destructive",title:"Not Authenticated",description:"You must be logged in to make an offer."});return}if(!m||!g||isNaN(parseFloat(g))||parseFloat(g)<=0){r({variant:"destructive",title:"Invalid Offer",description:"Please enter a valid offer amount."});return}try{const{error:c}=await F.from("offers").insert({listing_id:m.id,bidder_id:n.id,amount:parseFloat(g),status:"pending"});if(c)throw c;r({title:"Offer Submitted!",description:`Your offer of ${g} for "${m.title}" has been placed.`}),w(!1),p(""),D()}catch(c){r({variant:"destructive",title:"Offer Submission Failed",description:c.message})}},Ne=()=>{if(!m||!I.trim()){r({variant:"destructive",title:"Empty Message",description:"Please type a message before sending."});return}r({title:"Message Sent (Simulated)",description:`Your message to the owner of "${m.title}" has been sent.`}),l(!1),M(""),d(null)},ye=async(c,L)=>{try{const{error:N}=await F.from("offers").update({status:L}).eq("id",c);if(N)throw N;r({title:"Offer Updated",description:`The offer has been ${L}.`}),o(!1),D()}catch(N){r({variant:"destructive",title:"Offer Update Failed",description:N.message})}},we=c=>{if(!n||n.id===c.ownerId){r({variant:"destructive",title:"Action Not Allowed",description:n.id===c.ownerId?"You cannot make an offer on your own listing.":"Please log in to make an offer."});return}d(c),w(!0)},Ce=c=>{d(c),l(!0)},ke=(c,L)=>{k(c),d(L),o(!0)};return A?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(Z,{className:"h-16 w-16 animate-spin text-[hsl(var(--boogasi-blue-val))]"})}):n?e.jsxs("div",{className:"py-8 space-y-8 marketplace-page-container min-h-screen px-4",children:[e.jsxs(O.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center",children:[e.jsx("h1",{className:"text-5xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-[hsl(var(--boogasi-blue-val))] via-[hsl(var(--boogasi-teal-val))] to-[hsl(var(--boogasi-orange-val))]",children:"Investment Marketplace"}),e.jsx("p",{className:"text-xl max-w-2xl mx-auto text-muted-foreground",children:"Discover, bid on, and fund promising projects. Connect with entrepreneurs and grow your portfolio."}),e.jsxs("div",{className:"mt-2 inline-flex items-center justify-center px-3 py-1 text-xs font-medium text-[hsl(var(--boogasi-orange-val))] bg-[hsl(var(--boogasi-orange-val))]/20 rounded-full border border-[hsl(var(--boogasi-orange-val))]/40",children:[e.jsx(ce,{size:12,className:"mr-1"}),"Private Network"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-end p-4 border rounded-lg shadow-xl backdrop-blur-sm bg-card/70 border-border",children:[e.jsx("div",{className:"flex-grow w-full",children:e.jsx(oa,{searchTerm:s,setSearchTerm:h,selectedCategoryFilter:T,setSelectedCategoryFilter:ve,categories:W,amountRangeFilter:P,setAmountRangeFilter:fe})}),e.jsxs(R,{open:b,onOpenChange:v,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(y,{variant:"aiFutureGlow",className:"w-full md:w-auto h-12",children:[e.jsx(We,{className:"mr-2 h-5 w-5"})," List a Project"]})}),e.jsxs(z,{className:"sm:max-w-[600px] bg-card border-boogasi-blue text-foreground",children:[e.jsxs(G,{children:[e.jsx(Y,{className:"text-2xl text-boogasi-blue",children:"Create New Listing"}),e.jsx(q,{className:"text-muted-foreground",children:"Fill in the details for your investment opportunity."})]}),e.jsx(ra,{onSuccess:()=>{v(!1),D()}})]})]})]}),V?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(Z,{className:"h-12 w-12 animate-spin text-boogasi-blue"})}):a.length===0?e.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.4},className:"text-center py-12",children:[e.jsx(me,{className:"h-24 w-24 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2 text-foreground",children:"No listings found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search or filter terms, or create the first listing!"})]}):e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map((c,L)=>e.jsx(ia,{listing:c,index:L,user:n,onContact:Ce,onOffer:we,onManageOffer:ke},c.id))}),e.jsx(la,{isBidModalOpen:C,setIsBidModalOpen:w,selectedListing:m,bidAmount:g,setBidAmount:p,handleBidSubmit:je,isContactModalOpen:x,setIsContactModalOpen:l,contactMessage:I,setContactMessage:M,handleContactSubmit:Ne,userEmail:n==null?void 0:n.email,isManageOfferModalOpen:t,setIsManageOfferModalOpen:o,selectedOffer:u,handleManageOffer:ye})]}):e.jsxs("div",{className:"text-center py-12 brighter-theme-area min-h-screen flex flex-col justify-center items-center",children:[e.jsx(ce,{className:"h-24 w-24 mx-auto text-[hsl(var(--boogasi-pink-val))] mb-4"}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Access Denied"}),e.jsx("p",{className:"mb-6",children:"This is a private marketplace. Please log in to view listings."}),e.jsx(y,{onClick:()=>E("/auth?type=login&redirect=/marketplace"),className:"bg-[hsl(var(--boogasi-blue-val))] hover:bg-[hsl(var(--boogasi-blue-val))]/90 text-primary-foreground",children:"Log In"})]})};export{wa as default};
