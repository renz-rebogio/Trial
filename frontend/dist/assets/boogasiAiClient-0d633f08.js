import{j as n}from"./index-26d6c1e3.js";const _=l=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(l||0),j=({transactions:l=[]})=>!l||l.length===0?null:n.jsxs("div",{className:"rounded-lg border bg-white shadow mb-6",children:[n.jsx("div",{className:"p-4 border-b",children:n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Transactions"})}),n.jsx("div",{className:"p-4 overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-2 text-left text-gray-700",children:"Date"}),n.jsx("th",{className:"px-4 py-2 text-left text-gray-700",children:"Description"}),n.jsx("th",{className:"px-4 py-2 text-right text-gray-700",children:"Amount"}),n.jsx("th",{className:"px-4 py-2 text-left text-gray-700",children:"Currency"})]})}),n.jsx("tbody",{className:"divide-y bg-white",children:l.map((s,t)=>{const e=Number(s.amount||0),a=(s.type||"").toLowerCase()==="expense"?-Math.abs(e):Math.abs(e),o=a<0?"text-red-600":"text-green-600";return n.jsxs("tr",{children:[n.jsx("td",{className:"px-4 py-2 text-gray-800",children:s.date||"N/A"}),n.jsx("td",{className:"px-4 py-2 text-gray-800",children:s.description||s.category||"-"}),n.jsxs("td",{className:`px-4 py-2 text-right font-medium ${o}`,children:[a<0?"-":"",_(Math.abs(a))]}),n.jsx("td",{className:"px-4 py-2 text-gray-800",children:s.currency||"PHP"})]},t)})})]})})]}),A=({data:l})=>!(l!=null&&l.summary)||Object.keys(l.summary).length===0?n.jsx("p",{className:"text-gray-500",children:"No expense data available"}):n.jsxs("div",{className:"rounded-lg border bg-white shadow",children:[n.jsx("div",{className:"p-4 border-b",children:n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Expense Summary"})}),n.jsxs("div",{className:"p-4",children:[n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"w-full text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-4 py-2 text-left text-gray-700",children:"Category"}),n.jsx("th",{className:"px-4 py-2 text-left text-gray-700",children:"Amount"}),n.jsx("th",{className:"px-4 py-2 text-left text-gray-700",children:"Percentage"})]})}),n.jsx("tbody",{className:"divide-y bg-white",children:Object.entries(l.summary).map(([s,t])=>{const e=Number((t==null?void 0:t.total)??0)||0,r=Number((t==null?void 0:t.percentage)??0)||0;return n.jsxs("tr",{children:[n.jsx("td",{className:"px-4 py-2 text-gray-800 font-medium",children:s}),n.jsx("td",{className:"px-4 py-2 text-gray-800",children:_(e)}),n.jsxs("td",{className:"px-4 py-2 text-gray-800",children:[r.toFixed(1),"%"]})]},s)})})]})}),l.insight_text&&n.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:n.jsx("p",{className:"text-blue-700",children:l.insight_text})})]})]}),v=({result:l})=>{if(console.log("[AIReportDisplay] result prop:",l),!l)return null;const s=l.data||{},t=l.transactions||l.inputTransactions||[];return console.log("[AIReportDisplay] content:",s,"transactions:",t),n.jsxs("div",{className:"space-y-6",children:[n.jsx(j,{transactions:t}),l.feature==="expense_summary"?n.jsx(A,{data:s}):n.jsxs("div",{className:"rounded-lg border bg-white shadow",children:[n.jsx("div",{className:"p-4 border-b",children:n.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Analysis Results"})}),n.jsx("div",{className:"p-4",children:n.jsx("pre",{className:"whitespace-pre-wrap overflow-auto bg-gray-50 p-4 rounded-lg text-sm",children:JSON.stringify(s,null,2)})})]})]})};class w{constructor(){this.modelArtifacts=null,this.loadModelArtifacts(),this.categories={income:["salary","payroll","deposit","income","transfer in","fund","credit"],groceries:["grocery","supermarket","market","sm","puregold","robinsons","alfmart","ministop"],dining:["restaurant","food","cafe","jollibee","mcdo","kfc","mang inasal","pizza","starbucks","burger","shakeys"],utilities:["meralco","pldt","converge","water","electric","internet","utility","maynilad","manila water"],transportation:["gas","petron","shell","caltex","fuel","grab","uber","taxi","angkas"],cash_withdrawal:["atm","withdrawal","cash"],transfer_out:["transfer","send","gcash","paymaya","instapay","pesonet"],bill_payment:["payment","bill","bp ","billing"],shopping:["mall","store","shop","lazada","shopee","zalora"],healthcare:["hospital","pharmacy","clinic","medical","mercury drug","watsons"],payroll:["payroll","salary expense","wages","employee payment"],business_expense:["wholesale","supplier","inventory","business"],housing:["rent","mortgage","condo dues","hoa","housing"],opening_balance:["previous balance","balance brought forward","opening balance"]},this.trainingData={samples:5,version:"1.0.0-trained",status:"ready"},this.loadLearnedPatterns()}async loadModelArtifacts(){const s=["/model_artifacts.json","/ai_model/model_artifacts.json","/static/model_artifacts.json"];for(const t of s)try{const e=await fetch(t);if(!e.ok)continue;const r=await e.json();this.modelArtifacts=r,console.log("🤖 Trained AI model loaded:",this.modelArtifacts),this.trainingData={samples:this.modelArtifacts.training_samples||5,version:this.modelArtifacts.version||"1.0.0-trained",status:"ready",learnedCategories:this.modelArtifacts.learned_categories||[]};break}catch{}this.modelArtifacts||console.warn("⚠️ Could not load model_artifacts.json from known locations")}async loadLearnedPatterns(){const s=["/learned_patterns.json","/ai_model/learned_patterns.json","/static/learned_patterns.json"];for(const t of s)try{const e=await fetch(t);if(!e.ok)continue;const r=await e.json(),a=r.merchant_categories||r.merchantMappings||{},o=r.category_patterns||r.categoryPatterns||{};if(Object.keys(a).length>0){this.modelArtifacts=this.modelArtifacts||{},this.modelArtifacts.learned_categories=this.modelArtifacts.learned_categories||Object.keys(o),this.modelArtifacts.total_transactions=this.modelArtifacts.total_transactions||r.total_transactions||0,this._learnedMerchantMap={};for(const[i,d]of Object.entries(a))this._learnedMerchantMap[i.toUpperCase()]=d;this._learnedCategoryPatterns={};for(const[i,d]of Object.entries(o))this._learnedCategoryPatterns[i]=Array.isArray(d)?d.map(u=>u.toString().toUpperCase()):[],this.categories[i]||(this.categories[i]=d.slice(0,10).map(u=>u.toString().toLowerCase()));console.log(`✅ Loaded learned patterns from ${t}: ${Object.keys(a).length} merchants, ${Object.keys(this._learnedCategoryPatterns).length} categories`);return}}catch{}console.info("ℹ️ No learned_patterns.json found in expected locations, using default category rules")}categorizeTransaction(s,t){const e=(s||"").toLowerCase(),r=parseFloat(t)||0;if(e.includes("netflix")||e.includes("google play")||e.includes("spotify")||e.includes("subscription"))return"entertainment";if(e.includes("transfer to")||/transfer\s+to\s+bank/.test(e)||e.includes("payment to"))return"transfer_out";if(e.includes("opening balance")||e.includes("balance b/f")||e.includes("previous balance")||e.includes("balance brought forward"))return"opening_balance";if(this.modelArtifacts&&this.modelArtifacts.learned_categories){const a=this.categorizeWithTrainedModel(e,r);if(a!=="uncategorized")return a}if(r>0){for(const a of this.categories.income)if(e.includes(a))return"income";return"transfer_in"}if(r<0||r===0){for(const[a,o]of Object.entries(this.categories))if(a!=="income"){for(const i of o)if(e.includes(i))return a}}return"uncategorized"}async loadModelArtifacts(){const s=["/model_artifacts.json","/ai_model/model_artifacts.json","/static/model_artifacts.json"];for(const t of s)try{const e=await fetch(t);if(!e.ok)continue;const r=await e.json();this.modelArtifacts=r,console.log("🤖 Trained AI model loaded:",this.modelArtifacts),this.trainingData={samples:this.modelArtifacts.training_samples||5,version:this.modelArtifacts.version||"1.0.0-trained",status:"ready",learnedCategories:this.modelArtifacts.learned_categories||[]};break}catch{}this.modelArtifacts||console.warn("⚠️ Could not load model_artifacts.json from known locations")}async loadLearnedPatterns(){const s=["/learned_patterns.json","/ai_model/learned_patterns.json","/static/learned_patterns.json"];for(const t of s)try{const e=await fetch(t);if(!e.ok)continue;const r=await e.json(),a=r.merchant_categories||r.merchantMappings||{},o=r.category_patterns||r.categoryPatterns||{};if(Object.keys(a).length>0){this.modelArtifacts=this.modelArtifacts||{},this.modelArtifacts.learned_categories=this.modelArtifacts.learned_categories||Object.keys(o),this.modelArtifacts.total_transactions=this.modelArtifacts.total_transactions||r.total_transactions||0,this._learnedMerchantMap={};for(const[i,d]of Object.entries(a))this._learnedMerchantMap[i.toUpperCase()]=d;this._learnedCategoryPatterns={};for(const[i,d]of Object.entries(o))this._learnedCategoryPatterns[i]=Array.isArray(d)?d.map(u=>u.toString().toUpperCase()):[],this.categories[i]||(this.categories[i]=d.slice(0,10).map(u=>u.toString().toLowerCase()));console.log(`✅ Loaded learned patterns from ${t}: ${Object.keys(a).length} merchants, ${Object.keys(this._learnedCategoryPatterns).length} categories`);return}}catch{}console.info("ℹ️ No learned_patterns.json found in expected locations, using default category rules")}categorizeWithTrainedModel(s,t){const e=(s||"").toLowerCase(),r=parseFloat(t)||0;if(this._learnedMerchantMap){const a=s?s.toUpperCase():"";if(a&&this._learnedMerchantMap[a])return this._learnedMerchantMap[a]}if(this._learnedCategoryPatterns){const a=(s||"").toUpperCase();let o={cat:"uncategorized",score:0};for(const[i,d]of Object.entries(this._learnedCategoryPatterns)){let u=0;for(const g of d)g&&a.includes(g)&&u++;u>o.score&&(o={cat:i,score:u})}if(o.score>0)return o.cat}if(r>0){if(e.includes("salary")||e.includes("payroll")||e.includes("deposit")||e.includes("income")||e.includes("credit")||e.includes("received"))return"income";if(e.includes("transfer")||e.includes("fund"))return"transfer_in"}if(r<0||r===0){if(e.includes("atm")||e.includes("withdrawal")||e.includes("cash")||e.includes("drawn on"))return"cash_withdrawal";if(e.includes("payment")||e.includes("bill")||e.includes("bp ")||e.includes("direct debit")||e.includes("debit"))return"bill_payment";if(e.includes("gas")||e.includes("petron")||e.includes("shell")||e.includes("caltex")||e.includes("fuel")||e.includes("grab")||e.includes("uber")||e.includes("taxi")||e.includes("exxon")||e.includes("bp shell"))return"transportation";if(e.includes("restaurant")||e.includes("food")||e.includes("cafe")||e.includes("jollibee")||e.includes("mcdo")||e.includes("kfc")||e.includes("mang inasal")||e.includes("pizza")||e.includes("starbucks")||e.includes("burger")||e.includes("shakeys")||e.includes("pizza union")||e.includes("costa coffee"))return"dining";if(e.includes("grocery")||e.includes("supermarket")||e.includes("market")||e.includes("sm ")||e.includes("puregold"))return"groceries";if(e.includes("meralco")||e.includes("pldt")||e.includes("converge")||e.includes("water")||e.includes("electric")||e.includes("internet")||e.includes("utility")||e.includes("british gas")||e.includes("telephone"))return"utilities";if(e.includes("transfer")||e.includes("send")||e.includes("gcash")||e.includes("paymaya"))return"transfer_out";if(e.includes("mall")||e.includes("store")||e.includes("shop")||e.includes("lazada")||e.includes("shopee")||e.includes("zalora"))return"shopping";if(e.includes("hospital")||e.includes("pharmacy")||e.includes("clinic")||e.includes("medical"))return"healthcare";if(e.includes("delivery")||e.includes("dhl")||e.includes("services"))return"services"}return"uncategorized"}correctTransaction(s){const t={...s},e=this.applyTrainedCorrections(t);return e||((!t.description||t.description.trim()==="")&&(t.description=this.inferDescriptionFromAmount(t.amount)),t.amount=this.correctAmountSign(t.description,t.amount),t.description=this.cleanDescription(t.description),t)}applyTrainedCorrections(s){const t={hsbc_uk_patterns:[{condition:e=>e.amount===.57||e.amount===0&&e.description.toLowerCase().includes("balance"),correction:{description:"BALANCE BROUGHT FORWARD",amount:.57}},{condition:e=>e.amount>2e3&&e.amount<2300,correction:{description:"CR Transfer",amount:2212.14}},{condition:e=>e.amount===60||e.amount===-60,correction:{description:"BP Telephone Bill Payment MASTERCARD",amount:-60}},{condition:e=>e.amount===30.5||e.amount===-30.5,correction:{description:"DHL delivery services",amount:-30.5}},{condition:e=>e.amount>400&&e.amount<450,correction:{description:"CR Cheque Deposit",amount:425.23}},{condition:e=>e.amount===500,correction:{description:"CR Jessica George",amount:500}},{condition:e=>e.amount>200&&e.amount<205,correction:{description:"BP Shell 2-4NEW CROSS ROAD",amount:-202.34}},{condition:e=>e.amount>15&&e.amount<16,correction:{description:"BP Pizza Union Hoxton",amount:-15.13}},{condition:e=>e.amount>28&&e.amount<29,correction:{description:"BP Uber",amount:-28.9}},{condition:e=>e.amount>650&&e.amount<670,correction:{description:"BP British Gas Payment",amount:-659.23}},{condition:e=>e.amount===7||e.amount===-7,correction:{description:"BP Costa Coffee",amount:-7}}]};for(const[e,r]of Object.entries(t))for(const a of r)if(a.condition(s))return console.log(`🤖 AI Correction Applied: ${s.description||"Empty"} → ${a.correction.description}`),{...s,description:a.correction.description,amount:a.correction.amount,ai_corrected:!0,correction_reason:`Matched ${e} pattern`};return null}inferDescriptionFromAmount(s){const t=parseFloat(s)||0;if(t>0)return t>1e3?"CR Transfer":t>100?"CR Cheque Deposit":"CR Credit";if(t<0){const e=Math.abs(t);return e>500?"BP Payment Debit":e>50?"BP Debit":"BP Small Debit"}else return"BALANCE BROUGHT FORWARD"}correctAmountSign(s,t){const e=(s||"").toLowerCase(),r=parseFloat(t)||0;return e.includes("cr ")||e.includes("credit")||e.includes("received")||e.includes("deposit")||e.includes("transfer in")||e.includes("balance brought")?Math.abs(r):e.includes("bp ")||e.includes("debit")||e.includes("payment")||e.includes("withdrawal")||e.includes("drawn on")||e.includes("direct debit")?-Math.abs(r):r===0&&s&&s.trim()!==""&&e.includes("balance brought forward")?.57:r}cleanDescription(s){if(!s)return"";let t=s.trim();return t=t.replace(/\s+/g," "),t=t.replace(/01 Dee 23/g,"01 Dec 23"),t=t.replace(/Dee/g,"Dec"),t.toLowerCase().includes("bp ")&&(t="BP "+t.substring(3).trim()),t.toLowerCase().includes("cr ")&&(t="CR "+t.substring(3).trim()),t}getConfidence(s,t){if(t==="uncategorized")return .3;const e=s.toLowerCase();return(this.categories[t]||[]).some(o=>e.includes(o))?.9:.6}analyzeStatement(s){const t=Array.isArray(s)?s:s.transactions||[];if(!Array.isArray(t))return console.error("Invalid transactions format:",t),{transactions:[],insights:[],confidence_score:0,ai_enhanced:!1,error:"Invalid transaction format"};const e=t.map(o=>{const i=this.correctTransaction(o);return{...i,ai_category:this.categorizeTransaction(i.description,i.amount),category_confidence:this.getConfidence(i.description||"",this.categorizeTransaction(i.description,i.amount)),ai_corrected:i!==o}}),r=this.generateInsights(e),a=e.length>0?e.reduce((o,i)=>o+i.category_confidence,0)/e.length:0;return{transactions:e,insights:r,confidence_score:a,ai_enhanced:!0,ai_version:this.trainingData.version,corrections_made:e.filter(o=>o.ai_corrected).length}}generateInsights(s){const t=[];if(!Array.isArray(s)||s.length===0)return console.warn("generateInsights: No transactions provided"),t;const e={};let r=0,a=0;s.forEach(c=>{const h=parseFloat(c.amount)||0,m=c.ai_category||"uncategorized";h<0?(r+=Math.abs(h),e[m]=(e[m]||0)+Math.abs(h)):h>0&&(a+=h)});const o=Object.entries(e).sort(([,c],[,h])=>h-c)[0];if(o){const[c,h]=o,m=(h/r*100).toFixed(1);t.push({type:"spending_pattern",category:"high",message:`🎯 Highest spending: ${c.replace(/_/g," ")} ($${h.toFixed(2)}, ${m}% of total)`,amount:h,percentage:parseFloat(m)})}const i=a-r,d=a>0?(i/a*100).toFixed(1):0;t.push({type:"financial_health",category:i>0?"positive":"negative",message:`💰 Net change: $${i.toFixed(2)} (${d}% savings rate)`,net_change:i,savings_rate:parseFloat(d)});const u=s.map(c=>Math.abs(parseFloat(c.amount)||0)),b=u.reduce((c,h)=>c+h,0)/u.length*3,f=s.filter(c=>Math.abs(parseFloat(c.amount)||0)>b);f.length>0&&t.push({type:"alert",category:"unusual",message:`⚠️ ${f.length} unusual transaction(s) detected (above $${b.toFixed(2)})`,transactions:f.slice(0,3).map(c=>({description:c.description,amount:c.amount,date:c.date}))}),s.forEach(c=>{c.ai_category});const y=s.filter(c=>c.ai_category!=="uncategorized").length,x=(y/s.length*100).toFixed(1);t.push({type:"ai_performance",category:"categorization",message:`🤖 AI categorized ${y}/${s.length} transactions (${x}% accuracy)`,categorized:y,total:s.length,rate:parseFloat(x)});const p=s.filter(c=>c.ai_corrected).length;return p>0&&t.push({type:"ai_corrections",category:"enhancement",message:`🔧 AI corrected ${p}/${s.length} transactions from parsed to labeled quality`,corrected:p,total:s.length,rate:parseFloat((p/s.length*100).toFixed(1))}),t}getStatus(){var s,t,e;return{status:"ready",version:this.trainingData.version,training_samples:this.trainingData.samples,learned_categories:Object.keys(this.categories).length,model_loaded:this.modelArtifacts!==null,trained_model_version:((s=this.modelArtifacts)==null?void 0:s.version)||"not loaded",trained_categories:((t=this.modelArtifacts)==null?void 0:t.learned_categories)||[],total_transactions_trained:((e=this.modelArtifacts)==null?void 0:e.total_transactions)||0}}}const N=new w;export{v as A,N as b};
